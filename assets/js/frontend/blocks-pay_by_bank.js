(()=>{"use strict";const e=window.React,a=window.wp.i18n,n=window.wc.wcBlocksRegistry,t=window.wc.wcSettings,s=window.wp.element,c=window.wp.htmlEntities;function o(e,a,n){e&&fetch(e,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({message:a,context:n})}).catch((e=>{}))}function i(e,n,t,s){void 0===s&&(s={}),void 0===s.settings&&(s.settings={});const c=e.orderId,i=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",r=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"",d=!0===t.log_errors&&t.log_error_endpoint||null;let l=null,p=parseInt(n.cartTotals.total_price);if(!c||!p)return o(d,(0,a.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),{type:emitResponse.responseTypes.ERROR,message:(0,a.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")};{let e=n.cartTotals.currency_code,m=n.billingAddress.first_name,u=n.billingAddress.last_name,f=n.billingAddress.email,b=n.billingAddress.address_1,y=n.billingAddress.address_2,h=n.billingAddress.city,_=n.billingAddress.postcode,g=n.billingAddress.state,x=n.billingAddress.country,E=s&&s.additional&&s.additional.phone?s.additional.phone:n.billingAddress.phone||"";const k={transactionSource:s.transactionSource,amount:p,transactionType:"PAYMENT",currency:e,merchantRefNum:r,environment:t.test_mode?"TEST":"LIVE",displayPaymentMethods:s.displayPaymentMethods,paymentMethodDetails:s.paymentMethodDetails,threeDs:{merchantUrl:t.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"},locale:t.locale};t.merchant_descriptor&&t.merchant_phone&&(k.merchantDescriptor={dynamicDescriptor:t.merchant_descriptor,phone:t.merchant_phone}),i&&(k.singleUseCustomerToken=i,s.customer&&(k.customer=s.customer)),i&&!s.settings.add_customer_when_single_use_token||(s.customer?k.customer=s.customer:k.customer={firstName:m,lastName:u,email:f}),i&&!s.settings.add_billing_when_single_use_token||(k.billingAddress={nickName:"Home",zip:_,country:x},b&&(k.billingAddress.street=b),y&&(k.billingAddress.street2=y),h&&(k.billingAddress.city=h),g&&(k.billingAddress.state=g),E&&(k.billingAddress.phone=E)),s.settings.use_external_simulator&&t.test_mode&&(k.simulator="EXTERNAL"),s.shippingAddress&&(k.shippingAddress=s.shippingAddress);let w=null;paysafe.checkout.setup(t.authorization,k,(function(e,n,s){if(s&&s.paymentHandleToken){const n={orderId:c,paymentMethod:s.paymentMethod,transactionType:s.transactionType,paymentHandleToken:s.paymentHandleToken,amount:s.amount,customerOperation:s.customerOperation,merchantRefNum:k.merchantRefNum,nonce:t.nonce};fetch(t.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(n)}).then((e=>e.json())).then((n=>{"success"===n.status?e.showSuccessScreen((0,a.__)("Your goods are now purchased. Expect them to be delivered in next 5 business days.","paysafe-checkout")):e.showFailureScreen((0,a.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")),w=n.redirect_url})).catch((n=>{o(d,(0,a.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),e.showFailureScreen((0,a.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))}else{let t="";n&&(n.code&&(t+=n.code+" "),n.message&&(t+=n.message+" "),n.detailedMessage&&(t+=n.detailedMessage)),e?(o(d,(0,a.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout")+" "+t,{pace:3}),e.showFailureScreen((0,a.__)("The payment was declined. Please, try again with the same or another payment method. "+t,"paysafe-checkout"))):(l=(0,a.__)("The payment was declined. Please, try again with the same or another payment method.","paysafe-checkout"),n&&n.code&&n.detailedMessage&&(l+="<br /> "+n.code+" "+n.detailedMessage),o(d,l,[]),function(e){let a=document.getElementsByClassName("woocommerce-error");if(a=a.length>0?a[0]:null,!a){let e=document.getElementsByClassName("woocommerce-notices-wrapper"),n=e.length>0?e[0]:null;n&&(a=document.createElement("ul"),a.className="woocommerce-error",n.appendChild(a))}if(a){let n=document.createElement("li");n.setAttribute("id","paysafe-fatal-error-message"),n.innerHTML=e,a.appendChild(n),window.scrollTo({top:0,left:0,behavior:"smooth"})}}(l))}}),(function(e,a){if(e)switch(e){case"PAYMENT_HANDLE_NOT_CREATED":window.location.reload();break;case"PAYMENT_HANDLE_CREATED":case"PAYMENT_HANDLE_REDIRECT":case"PAYMENT_HANDLE_PAYABLE":if(null!==w)return void(window.location=w);window.location.reload()}else window.location.reload()}),(function(e,n,t){n===p?e.accept():(o(d,(0,a.__)("Amount is not the value expected","paysafe-checkout"),[]),e.decline((0,a.__)("Amount is not the value expected","paysafe-checkout")))}))}return e}const r="pay_by_bank",d=(0,t.getSetting)(r+"_data",{});let l={};const p=n=>{const{eventRegistration:t,emitResponse:r}=n,{onPaymentSetup:p,onCheckoutSuccess:m}=t;return(0,s.useEffect)((()=>{const e=p((async()=>{let e=document.getElementById("paybybank_consumeridInput"),n=e&&e.value&&e.value.length,t=document.getElementById("paybybank_dobInput"),s=t&&t.value&&t.value.length;return n&&s?{type:r.responseTypes.SUCCESS}:(o((0,a.__)("The payment process failed. SSN and Date of Birth must be set!","paysafe-checkout"),{}),{type:r.responseTypes.ERROR,message:(0,a.__)("The payment process failed. SSN and Date of Birth must be set!","paysafe-checkout")})}));return()=>{e()}}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,p]),(0,s.useEffect)((()=>{const e=m((e=>{let a=d.consumer_id_encrypted;a||(a=function(e){const a=(1n<<64n)-1n,n=[0x6a09e667f3bcc908n,0xbb67ae8584caa73bn,0x3c6ef372fe94f82bn,0xa54ff53a5f1d36f1n,0x510e527fade682d1n,0x9b05688c2b3e6c1fn,0x1f83d9abfb41bd6bn,0x5be0cd19137e2179n],t=[0x428a2f98d728ae22n,0x7137449123ef65cdn,0xb5c0fbcfec4d3b2fn,0xe9b5dba58189dbbcn,0x3956c25bf348b538n,0x59f111f1b605d019n,0x923f82a4af194f9bn,0xab1c5ed5da6d8118n,0xd807aa98a3030242n,0x12835b0145706fben,0x243185be4ee4b28cn,0x550c7dc3d5ffb4e2n,0x72be5d74f27b896fn,0x80deb1fe3b1696b1n,0x9bdc06a725c71235n,0xc19bf174cf692694n,0xe49b69c19ef14ad2n,0xefbe4786384f25e3n,0x0fc19dc68b8cd5b5n,0x240ca1cc77ac9c65n,0x2de92c6f592b0275n,0x4a7484aa6ea6e483n,0x5cb0a9dcbd41fbd4n,0x76f988da831153b5n,0x983e5152ee66dfabn,0xa831c66d2db43210n,0xb00327c898fb213fn,0xbf597fc7beef0ee4n,0xc6e00bf33da88fc2n,0xd5a79147930aa725n,0x06ca6351e003826fn,0x142929670a0e6e70n,0x27b70a8546d22ffcn,0x2e1b21385c26c926n,0x4d2c6dfc5ac42aedn,0x53380d139d95b3dfn,0x650a73548baf63den,0x766a0abb3c77b2a8n,0x81c2c92e47edaee6n,0x92722c851482353bn,0xa2bfe8a14cf10364n,0xa81a664bbc423001n,0xc24b8b70d0f89791n,0xc76c51a30654be30n,0xd192e819d6ef5218n,0xd69906245565a910n,0xf40e35855771202an,0x106aa07032bbd1b8n,0x19a4c116b8d2d0c8n,0x1e376c085141ab53n,0x2748774cdf8eeb99n,0x34b0bcb5e19b48a8n,0x391c0cb3c5c95a63n,0x4ed8aa4ae3418acbn,0x5b9cca4f7763e373n,0x682e6ff3d6b2b8a3n,0x748f82ee5defb2fcn,0x78a5636f43172f60n,0x84c87814a1f0ab72n,0x8cc702081a6439ecn,0x90befffa23631e28n,0xa4506cebde82bde9n,0xbef9a3f7b2c67915n,0xc67178f2e372532bn,0xca273eceea26619cn,0xd186b8c721c0c207n,0xeada7dd6cde0eb1en,0xf57d4f7fee6ed178n,0x06f067aa72176fban,0x0a637dc5a2c898a6n,0x113f9804bef90daen,0x1b710b35131c471bn,0x28db77f523047d84n,0x32caab7b40c72493n,0x3c9ebe0a15c9bebcn,0x431d67c49c100d4cn,0x4cc5d4becb3e42b6n,0x597f299cfc657e2an,0x5fcb6fab3ad6faecn,0x6c44198c4a475817n],s=(e,n)=>(e>>BigInt(n)|e<<BigInt(64-n))&a,c=(e,a)=>e>>BigInt(a),o=(e,a,n)=>e&a^~e&n,i=(e,a,n)=>e&a^e&n^a&n,r=e=>s(e,28)^s(e,34)^s(e,39),d=e=>s(e,14)^s(e,18)^s(e,41),l=e=>s(e,1)^s(e,8)^c(e,7),p=Array.from((new TextEncoder).encode(e)),m=8n*BigInt(p.length);for(p.push(128);p.length%128!=112;)p.push(0);const u=m>>64n,f=m&a;for(let e=7;e>=0;e--)p.push(Number(u>>BigInt(8*e)&0xffn));for(let e=7;e>=0;e--)p.push(Number(f>>BigInt(8*e)&0xffn));for(let e=0;e<p.length;e+=128){const m=new Array(80).fill(0n);for(let a=0;a<16;a++){let n=0n;for(let t=0;t<8;t++)n=n<<8n|BigInt(p[e+8*a+t]);m[a]=n}for(let e=16;e<80;e++)m[e]=(b=m[e-2],(s(b,19)^s(b,61)^c(b,6))+m[e-7]+l(m[e-15])+m[e-16]&a);let[u,f,y,h,_,g,x,E]=n;for(let e=0;e<80;e++){const n=E+d(_)+o(_,g,x)+t[e]+m[e]&a,s=r(u)+i(u,f,y)&a;E=x,x=g,g=_,_=h+n&a,h=y,y=f,f=u,u=n+s&a}n[0]=n[0]+u&a,n[1]=n[1]+f&a,n[2]=n[2]+y&a,n[3]=n[3]+h&a,n[4]=n[4]+_&a,n[5]=n[5]+g&a,n[6]=n[6]+x&a,n[7]=n[7]+E&a}var b;return n.map((e=>e.toString(16).padStart(16,"0"))).join("").substring(0,50)}(l.billingAddress.email));let n=document.getElementById("paybybank_consumeridInput"),t=n&&n.value&&n.value.length?n.value:"",s=document.getElementById("paybybank_dobInput"),c=s&&s.value&&s.value.length?s.value:"",o="",r="",p="";if(c){const e=new Date(c);isNaN(e.getTime())||(o=e.getFullYear(),r=e.getMonth()+1,p=e.getDate())}let m={firstName:l.billingAddress.first_name,lastName:l.billingAddress.last_name,email:l.billingAddress.email,identityDocuments:[{type:"SOCIAL_SECURITY",documentNumber:t}],dateOfBirth:{year:o,month:r,day:p}};return l.billingAddress.phone&&(m.phone=l.billingAddress.phone),i(e,l,d,{transactionSource:"WooCommerceCheckout",displayPaymentMethods:["pay_by_bank"],paymentMethodDetails:{payByBank:{accountId:d.account_id,consumerId:a}},customer:m})}));return()=>{e()}}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,"",[],m]),function(n,t=""){let s=[(0,e.createElement)("div",null,(0,c.decodeEntities)(n.description||""))];return n.test_mode&&(s.push((0,e.createElement)("hr",null)),s.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"10px"}},(0,e.createElement)("span",null,(0,a.__)("Paysafe Checkout is in TEST mode. Use the built-in simulator to test payments.","paysafe-checkout"))))),t&&s.push(t),s}(d,(0,e.createElement)("div",null,(0,e.createElement)("div",{id:"paysafe-hosted-payment-form",className:"paysafe-hosted-payment-form"},(0,e.createElement)("label",{id:"paybybank_consumerid_label",className:"paysafe-general-form-label",htmlFor:"paybybank_consumeridInput"},(0,a.__)("SSN","paysafe-checkout")),(0,e.createElement)("div",{id:"paybybank_consumerid",className:"paysafe-input-field"},(0,e.createElement)("input",{type:"text",className:"paysafe-input-field-input",name:"paybybank_consumerid_input",id:"paybybank_consumeridInput",placeholder:(0,a.__)("Your SSN","paysafe-checkout"),min:"2",minLength:"2"})),(0,e.createElement)("p",{id:"paybybank_consumerid_spacer",className:"paysafe-general-form-spacer"},(0,a.__)("Enter the consumer id from your Pay By Bank account","paysafe-checkout"))),(0,e.createElement)("div",{id:"paysafe-hosted-payment-form2",className:"paysafe-hosted-payment-form"},(0,e.createElement)("label",{id:"paybybank_dob_label",className:"paysafe-general-form-label",htmlFor:"paybybank_dobInput"},(0,a.__)("Date of birth","paysafe-checkout")),(0,e.createElement)("div",{id:"paybybank_dob",className:"paysafe-input-field"},(0,e.createElement)("input",{type:"date",className:"paysafe-input-field-input",name:"paybybank_dob_input",id:"paybybank_dobInput",placeholder:(0,a.__)("Your Date of birth","paysafe-checkout"),min:"2",minLength:"2"})),(0,e.createElement)("p",{id:"paybybank_dob_spacer",className:"paysafe-general-form-spacer"},(0,a.__)("Enter your Date of Birth for your Pay By Bank account","paysafe-checkout")))))},m={name:r,paymentMethodId:r,label:function(n,t){const s=(0,c.decodeEntities)(n)||(0,a.__)("Paysafe Checkout","paysafe-checkout");return(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,s),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:t,alt:s}))}(d.title,d.icon),content:(0,e.createElement)(p,null),edit:(0,e.createElement)(p,null),canMakePayment:e=>(l=e,!0),ariaLabel:(0,a.__)("Paysafe Checkout","paysafe-checkout"),supports:{features:d.supports}};(0,n.registerPaymentMethod)(m)})();