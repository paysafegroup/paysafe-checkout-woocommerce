(()=>{"use strict";const e=window.React,t=window.wp.i18n,n=window.wc.wcBlocksRegistry,s=window.wc.wcSettings,a=window.wp.element,r=window.wp.htmlEntities;function o(e,t,n){e&&fetch(e,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({message:t,context:n})}).catch((e=>{}))}function i(e,n,s,a){void 0===a&&(a={}),void 0===a.settings&&(a.settings={});const r=e.orderId,i=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",l=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"",c=!0===s.log_errors&&s.log_error_endpoint||null;let p=null,d=parseInt(n.cartTotals.total_price);if(!r||!d)return o(c,(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),{type:emitResponse.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")};{let e=n.cartTotals.currency_code,m=n.billingAddress.first_name,u=n.billingAddress.last_name,h=n.billingAddress.email,y=n.billingAddress.address_1,_=n.billingAddress.address_2,f=n.billingAddress.city,g=n.billingAddress.postcode,E=n.billingAddress.state,b=n.billingAddress.country,v=a&&a.additional&&a.additional.phone?a.additional.phone:n.billingAddress.phone||"";const w={transactionSource:a.transactionSource,amount:d,transactionType:"PAYMENT",currency:e,merchantRefNum:l,environment:s.test_mode?"TEST":"LIVE",displayPaymentMethods:a.displayPaymentMethods,paymentMethodDetails:a.paymentMethodDetails,threeDs:{merchantUrl:s.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"},locale:s.locale};s.merchant_descriptor&&s.merchant_phone&&(w.merchantDescriptor={dynamicDescriptor:s.merchant_descriptor,phone:s.merchant_phone}),i&&(w.singleUseCustomerToken=i,a.customer&&(w.customer=a.customer)),i&&!a.settings.add_customer_when_single_use_token||(a.customer?w.customer=a.customer:w.customer={firstName:m,lastName:u,email:h}),i&&!a.settings.add_billing_when_single_use_token||(w.billingAddress={nickName:"Home",zip:g,country:b},y&&(w.billingAddress.street=y),_&&(w.billingAddress.street2=_),f&&(w.billingAddress.city=f),E&&(w.billingAddress.state=E),v&&(w.billingAddress.phone=v)),a.shippingAddress&&(w.shippingAddress=a.shippingAddress);let T=null;paysafe.checkout.setup(s.authorization,w,(function(e,n,a){if(a&&a.paymentHandleToken){const n={orderId:r,paymentMethod:a.paymentMethod,transactionType:a.transactionType,paymentHandleToken:a.paymentHandleToken,amount:a.amount,customerOperation:a.customerOperation,merchantRefNum:w.merchantRefNum,nonce:s.nonce};fetch(s.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(n)}).then((e=>e.json())).then((n=>{"success"===n.status?e.showSuccessScreen((0,t.__)("Your goods are now purchased. Expect them to be delivered in next 5 business days.","paysafe-checkout")):e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")),T=n.redirect_url})).catch((n=>{o(c,(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))}else{let s="";n&&(n.code&&(s+=n.code+" "),n.message&&(s+=n.message+" "),n.detailedMessage&&(s+=n.detailedMessage)),e?(o(c,(0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout")+" "+s,{pace:3}),e.showFailureScreen((0,t.__)("The payment was declined. Please, try again with the same or another payment method. "+s,"paysafe-checkout"))):(p=(0,t.__)("The payment was declined. Please, try again with the same or another payment method.","paysafe-checkout"),n&&n.code&&n.detailedMessage&&(p+="<br /> "+n.code+" "+n.detailedMessage),o(c,p,[]),function(e){let t=document.getElementsByClassName("woocommerce-error");if(t=t.length>0?t[0]:null,!t){let e=document.getElementsByClassName("woocommerce-notices-wrapper"),n=e.length>0?e[0]:null;n&&(t=document.createElement("ul"),t.className="woocommerce-error",n.appendChild(t))}if(t){let n=document.createElement("li");n.setAttribute("id","paysafe-fatal-error-message"),n.innerHTML=e,t.appendChild(n),window.scrollTo({top:0,left:0,behavior:"smooth"})}}(p))}}),(function(e,t){if(e)switch(e){case"PAYMENT_HANDLE_NOT_CREATED":window.location.reload();break;case"PAYMENT_HANDLE_CREATED":case"PAYMENT_HANDLE_REDIRECT":case"PAYMENT_HANDLE_PAYABLE":if(null!==T)return void(window.location=T);window.location.reload()}else window.location.reload()}),(function(e,n,s){n===d?e.accept():(o(c,(0,t.__)("Amount is not the value expected","paysafe-checkout"),[]),e.decline((0,t.__)("Amount is not the value expected","paysafe-checkout")))}))}return e}const l="vippreferred",c=(0,s.getSetting)(l+"_data",{});let p={},d=!1;const m=n=>{const{eventRegistration:s,emitResponse:l}=n,{onPaymentSetup:m,onCheckoutSuccess:u}=s;return d||(d=!0,setTimeout((()=>{let e=document.getElementById("vippreferred_phonenumberInput");e&&(e.value=p&&p.billingAddress&&p.billingAddress.phone?p.billingAddress.phone:"")}),100)),(0,a.useEffect)((()=>{const e=m((async()=>{let e=document.getElementById("vippreferred_consumeridInput"),n=e&&e.value&&e.value.length&&9===e.value.length,s=document.getElementById("vippreferred_phonenumberInput"),a=s&&s.value&&s.value.length&&s.value.length>=9;return n&&a?{type:l.responseTypes.SUCCESS}:(o("The payment process validation failed. Customer`s phone number must be provided!",{}),{type:l.responseTypes.ERROR,message:(0,t.__)("The payment process validation failed. Your phone number must be provided!","paysafe-checkout")})}));return()=>{e()}}),[l.responseTypes.ERROR,l.responseTypes.SUCCESS,m]),(0,a.useEffect)((()=>{const e=u((e=>{let t=document.getElementById("vippreferred_consumeridInput"),n=t&&t.value&&t.value.length&&9===t.value.length?t.value:"",s=document.getElementById("vippreferred_phonenumberInput"),a=s&&s.value&&s.value.length&&s.value.length>=9?s.value:"";return i(e,p,c,{transactionSource:"WooCommerce",displayPaymentMethods:["vippreferred"],paymentMethodDetails:{vippreferred:{accountId:c.account_id,consumerId:n}},customer:{firstName:p.billingAddress.first_name,lastName:p.billingAddress.last_name,email:p.billingAddress.email,phone:a},additional:{phone:a},settings:{add_customer_when_single_use_token:!0,add_billing_when_single_use_token:!0}})}));return()=>{e()}}),[l.responseTypes.ERROR,l.responseTypes.SUCCESS,"",[],u]),function(n,s=""){let a=[(0,e.createElement)("div",null,(0,r.decodeEntities)(n.description||""))];return n.test_mode&&(a.push((0,e.createElement)("hr",null)),a.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"10px"}},(0,e.createElement)("span",null,(0,t.__)("Paysafe Checkout is in TEST mode. Use the built-in simulator to test payments.","paysafe-checkout"))))),s&&a.push(s),a}(c,(0,e.createElement)("div",null,(0,e.createElement)("div",{id:"paysafe-hosted-payment-form",className:"paysafe-hosted-payment-form"},(0,e.createElement)("label",{id:"vippreferred_consumerid_label",className:"paysafe-general-form-label",htmlFor:"vippreferred_consumeridInput"},(0,t.__)("Your social security number","paysafe-checkout")),(0,e.createElement)("div",{id:"vippreferred_consumerid",className:"paysafe-input-field"},(0,e.createElement)("input",{type:"text",className:"paysafe-input-field-input",name:"vippreferred_consumerid_input",id:"vippreferred_consumeridInput",placeholder:(0,t.__)("Your social security number","paysafe-checkout"),min:"9",minLength:"9",max:"9",maxLength:"9"})),(0,e.createElement)("p",{id:"vippreferred_consumerid_spacer",className:"paysafe-general-form-spacer"},(0,t.__)("Enter your social security number","paysafe-checkout"))),(0,e.createElement)("div",{id:"paysafe-hosted-payment-form",className:"paysafe-hosted-payment-form"},(0,e.createElement)("label",{id:"vippreferred_phonenumber_label",className:"paysafe-general-form-label",htmlFor:"vippreferred_phonenumberInput"},(0,t.__)("Your phone number","paysafe-checkout")),(0,e.createElement)("div",{id:"vippreferred_phonenumber",className:"paysafe-input-field"},(0,e.createElement)("input",{type:"tel",className:"paysafe-input-field-input",name:"vippreferred_phonenumber_input",id:"vippreferred_phonenumberInput",placeholder:(0,t.__)("Your phone number","paysafe-checkout")})),(0,e.createElement)("p",{id:"vippreferred_consumerid_spacer",className:"paysafe-general-form-spacer"},(0,t.__)("Enter your phone number","paysafe-checkout")))))},u={name:l,paymentMethodId:l,label:function(n,s){const a=(0,r.decodeEntities)(n)||(0,t.__)("Paysafe Checkout","paysafe-checkout");return(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,a),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:s,alt:a}))}(c.title,c.icon),content:(0,e.createElement)(m,null),edit:(0,e.createElement)(m,null),canMakePayment:e=>(p=e,!0),ariaLabel:(0,t.__)("Paysafe Checkout","paysafe-checkout"),supports:{features:c.supports}};(0,n.registerPaymentMethod)(u)})();