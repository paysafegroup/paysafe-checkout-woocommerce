(()=>{"use strict";const e=window.React,t=window.wp.i18n,s=window.wc.wcBlocksRegistry,a=window.wp.htmlEntities,n=window.wc.wcSettings,o=window.wp.element,r="google_pay",i=(0,n.getSetting)("google_pay_data",{});let c=!1;i.is_apple_pay_express_enabled&&i.is_google_pay_express_enabled&&(c=!0);let l=!0;const d=function(e,t){!0===i.log_errors&&i.log_error_endpoint&&fetch(i.log_error_endpoint,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({message:e,context:t})}).catch((e=>{}))},p="paysafe_js"===i.integration_type,u=(0,a.decodeEntities)(i.title)||"Paysafe Checkout",m=()=>(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,u),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:i.icon,alt:u}));let y=0,g={},h=null,_=null,f=!1;const E=function(e,s,a){if(!jQuery("#paysafe-hosted-google-pay-payment-form").length)return;if(i.is_apple_pay_express_enabled&&i.is_google_pay_express_enabled)return;if(f)return;if("undefined"==typeof paysafe||void 0===paysafe.fields)return void setTimeout((function(){E(e,s,a)}),1e3);f=!0;const n={currencyCode:i.currency_code,environment:i.test_mode?"TEST":"LIVE",transactionSource:"WooCommerceJs",accounts:{default:i.account_id,googlePay:i.account_id},fields:{googlePay:{selector:"#paysafe-google-pay",type:"buy",color:"black",label:(0,t.__)("Google Pay","paysafe-checkout"),merchantId:i.express_merchant_ref_num,country:i.google_pay_issuer_country}}};y=parseInt(g.cartTotals.total_price);let o=g.billingAddress.address_1,c=(g.billingAddress.address_2,g.billingAddress.city),p=g.billingAddress.postcode,u=g.billingAddress.state,m=g.billingAddress.country;m&&(n.fields.googlePay.supportedCountries=[m]);let h=!1;paysafe.fields.setup(i.authorization,n).then((e=>(_=e,e.show()))).then((s=>{s.googlePay&&!s.googlePay.error&&document.getElementById("paysafe-google-pay").addEventListener("click",(function(s){s.preventDefault(),s.stopPropagation(),e(),h=!0,fetch(i.express_checkout_endpoint,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({gateway_id:r,nonce:i.nonce})}).then((e=>e.json())).then((e=>{if("success"===e.status){if(y=parseInt(g.cartTotals.total_price),!y)return d("ERROR: Express checkout order amount is not set",[]),void a((0,t.__)("ERROR: Express checkout order amount is not set","paysafe-checkout"));const s=e.order_id||null;if(!s)return d("ERROR: Express checkout couldn't create Order",[]),void a((0,t.__)("ERROR: Express checkout couldn't create the order","paysafe-checkout"));const n=g.cartTotals.currency_code,r=e.merchant_ref_num||"google_pay_"+Date.now(),l={transactionSource:"WooCommerceJs",amount:y,transactionType:"PAYMENT",currency:n,merchantRefNum:r,environment:i.test_mode?"TEST":"LIVE",paymentType:"GOOGLEPAY",googlePay:{country:i.google_pay_issuer_country,requiredBillingContactFields:["email"],requiredShippingContactFields:["name"]},accountId:i.account_id,customerDetails:{billingDetails:{country:m,zip:p,street:o,city:c,state:u}},threeDs:{merchantUrl:i.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"}};_.tokenize(l).then((e=>{const t={orderId:s,paymentMethod:"GOOGLEPAY",transactionType:"PAYMENT",paymentHandleToken:e.token,amount:y,customerOperation:"",merchantRefNum:r,nonce:i.nonce};fetch(i.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{"success"===e.status?_.complete("success"):(a("ERROR: Express checkout payment failed"+(e.message?" ("+e.message+")":"")),_.complete("fail")),window.location=e.redirect_url})).catch((e=>{const t="ERROR "+e.code+": "+e.detailedMessage;d(t,[]),a(t),_.complete("fail")}))})).catch((e=>{const t=e.displayMessage?e.displayMessage:"ERROR "+e.code+(e.detailedMessage?": "+e.detailedMessage:"");d(t,[]),e.detailedMessage&&e.detailedMessage.includes("User aborted payment")?a(e.detailedMessage):a(t)}))}else a((0,t.__)("ERROR: Express checkout couldn't create the order","paysafe-checkout"))}))}),!1)})).catch((e=>{9023===parseInt(e.code)&&(l=!1);let s="ERROR "+e.code+(e.detailedMessage?": "+e.detailedMessage:"");e.displayMessage&&(s=e.displayMessage+(e.detailedMessage?": "+e.detailedMessage:"")),d(s,[]),e.detailedMessage&&e.detailedMessage.includes("User aborted payment")?a(e.detailedMessage):h?(h=!1,a(s)):a((0,t.__)("Error! Unable to set up Express Checkout at this moment. Please, try again later.","paysafe-checkout")+(e.code?" ("+e.code+")":""))}))},T=s=>{const{eventRegistration:n,emitResponse:r}=s,{onCheckoutSuccess:c}=n;(0,o.useEffect)((()=>{const e=c((e=>{const s=e.orderId,a=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",n=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"";let o=null;if(y=parseInt(g.cartTotals.total_price),!s||!y)return d((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),{type:r.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")};{let e=g.cartTotals.currency_code,r=g.billingAddress.first_name,c=g.billingAddress.last_name,l=g.billingAddress.email,p=g.billingAddress.address_1,u=g.billingAddress.address_2,m=g.billingAddress.city,_=g.billingAddress.postcode,f=g.billingAddress.state,E=g.billingAddress.country;g.billingAddress.phone;const T={transactionSource:"WooCommerceCheckout",amount:y,transactionType:"PAYMENT",currency:e,merchantRefNum:n,environment:i.test_mode?"TEST":"LIVE",displayPaymentMethods:["googlePay"],paymentMethodDetails:{googlePay:{accountId:i.account_id,label:"google_pay",merchantId:n,requestBillingAddress:!0,requiredBillingContactFields:["email"],requiredShippingContactFields:["name"],country:i.google_pay_issuer_country}},threeDs:{merchantUrl:i.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"},locale:i.locale};i.merchant_descriptor&&i.merchant_phone&&(T.merchantDescriptor={dynamicDescriptor:i.merchant_descriptor,phone:i.merchant_phone}),T.singleUseCustomerToken=a,T.customer={firstName:r,lastName:c,email:l},T.billingAddress={nickName:"Home",zip:_,country:E},p&&(T.billingAddress.street=p),u&&(T.billingAddress.street2=u),m&&(T.billingAddress.city=m),f&&(T.billingAddress.state=f),paysafe.checkout.setup(i.authorization,T,(function(e,a,n){if(n&&n.paymentHandleToken){const o={orderId:s,paymentMethod:n.paymentMethod,transactionType:n.transactionType,paymentHandleToken:n.paymentHandleToken,amount:n.amount,customerOperation:n.customerOperation,merchantRefNum:T.merchantRefNum,nonce:i.nonce};fetch(i.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(o)}).then((e=>e.json())).then((s=>{"success"===s.status?e.showSuccessScreen((0,t.__)("Your goods are now purchased. Expect them to be delivered in next 5 business days.","paysafe-checkout")):(d("Payment failed. Popup was closed without a correct end message!",a),e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))),h=s.redirect_url})).catch((s=>{d((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),s),e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))}else{let s="";a&&(a.code&&(s+=a.code+" "),a.message&&(s+=a.message+" "),a.detailedMessage&&(s+=a.detailedMessage)),e?(d((0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout")+" "+s,{pace:3}),e.showFailureScreen((0,t.__)("The payment was declined. Please, try again with the same or another payment method. "+s,"paysafe-checkout"))):(o=(0,t.__)("The payment was declined. Please, try again with the same or another payment method.","paysafe-checkout"),a&&a.code&&a.detailedMessage&&(o+="<br /> "+a.code+" "+a.detailedMessage),d(o,[]),function(e){let t=document.getElementsByClassName("woocommerce-error");if(t=t.length>0?t[0]:null,!t){let e=document.getElementsByClassName("woocommerce-notices-wrapper"),s=e.length>0?e[0]:null;s&&(t=document.createElement("ul"),t.className="woocommerce-error",s.appendChild(t))}if(t){let s=document.getElementById("paysafe-fatal-error-message");s?s.innerHTML=e:(s=document.createElement("li"),s.setAttribute("id","paysafe-fatal-error-message"),s.innerHTML=e,t.appendChild(s),window.scrollTo({top:0,left:0,behavior:"smooth"}))}}(o))}}),(function(e,t){if(e)switch(e){case"PAYMENT_HANDLE_NOT_CREATED":window.location.reload();break;case"PAYMENT_HANDLE_CREATED":case"PAYMENT_HANDLE_REDIRECT":case"PAYMENT_HANDLE_PAYABLE":if(null!==h)return void(window.location=h);window.location.reload()}else window.location.reload()}),(function(e,s,a){s===y?e.accept():(d((0,t.__)("Amount is not the value expected","paysafe-checkout"),[]),e.decline((0,t.__)("Amount is not the value expected","paysafe-checkout")))}))}return e}));return()=>{e()}}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,"",[],c]);let l=[(0,e.createElement)("div",null,(0,a.decodeEntities)(i.description||""))];return i.test_mode&&(l.push((0,e.createElement)("hr",null)),l.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"10px"}},(0,e.createElement)("span",null,(0,t.__)("Paysafe Checkout is in TEST mode. Use the built-in simulator to test payments.","paysafe-checkout"))))),l},R=()=>(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,u),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:i.icon,alt:u})),w=s=>{const{eventRegistration:n,onClick:r,onClose:c,onError:l}=s,{onCheckoutSuccess:d}=n;(0,o.useEffect)((()=>{E(r,c,l);const e=d((e=>e));return()=>{e()}}),[[],{},d]);let p=[(0,e.createElement)("div",null,(0,a.decodeEntities)(i.description||""))];return i.test_mode&&(p.push((0,e.createElement)("hr",null)),p.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"10px"}},(0,e.createElement)("span",null,(0,t.__)("Paysafe Checkout is in TEST mode. Use the built-in simulator to test payments.","paysafe-checkout")))),p.push((0,e.createElement)("p",null))),p.push(wp.element.RawHTML({children:i.integration_hosted_form})),p};if(p){const t={name:r,title:"Google Pay Express Checkout",description:i.description,gatewayId:"paysafe",label:(0,e.createElement)(R,null),content:(0,e.createElement)(w,null),edit:(0,e.createElement)(w,null),canMakePayment:e=>(g=e,l&&e.billingAddress&&""!==e.billingAddress.email&&""!==e.billingAddress.first_name&&""!==e.billingAddress.last_name&&""!==e.billingAddress.address_1&&""!==e.billingAddress.city&&""!==e.billingAddress.postcode?!c:(f=!1,!1)),paymentMethodId:r,supports:{features:i.supports}};(0,s.registerExpressPaymentMethod)(t)}else{const t={name:r,paymentMethodId:r,label:(0,e.createElement)(m,null),content:(0,e.createElement)(T,null),edit:(0,e.createElement)(T,null),canMakePayment:e=>(g=e,!0),ariaLabel:u,supports:{features:i.supports}};(0,s.registerPaymentMethod)(t)}})();