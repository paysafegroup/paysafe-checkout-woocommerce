(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wc.wcBlocksRegistry,s=window.wc.wcSettings,n=window.wp.element,o=window.wp.htmlEntities;function i(e,t,a){e&&fetch(e,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({message:t,context:a})}).catch((e=>{}))}function c(e,a,s,n){void 0===n&&(n={}),void 0===n.settings&&(n.settings={});const o=e.orderId,c=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",r=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"",l=!0===s.log_errors&&s.log_error_endpoint||null;let p=null,d=parseInt(a.cartTotals.total_price);if(!o||!d)return i(l,(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),{type:emitResponse.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")};{let e=a.cartTotals.currency_code,m=a.billingAddress.first_name,u=a.billingAddress.last_name,y=a.billingAddress.email,h=a.billingAddress.address_1,_=a.billingAddress.address_2,f=a.billingAddress.city,g=a.billingAddress.postcode,E=a.billingAddress.state,w=a.billingAddress.country,T=n&&n.additional&&n.additional.phone?n.additional.phone:a.billingAddress.phone||"";const A={transactionSource:n.transactionSource,amount:d,transactionType:"PAYMENT",currency:e,merchantRefNum:r,environment:s.test_mode?"TEST":"LIVE",displayPaymentMethods:n.displayPaymentMethods,paymentMethodDetails:n.paymentMethodDetails,threeDs:{merchantUrl:s.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"},locale:s.locale};s.merchant_descriptor&&s.merchant_phone&&(A.merchantDescriptor={dynamicDescriptor:s.merchant_descriptor,phone:s.merchant_phone}),c&&(A.singleUseCustomerToken=c,n.customer&&(A.customer=n.customer)),c&&!n.settings.add_customer_when_single_use_token||(n.customer?A.customer=n.customer:A.customer={firstName:m,lastName:u,email:y}),c&&!n.settings.add_billing_when_single_use_token||(A.billingAddress={nickName:"Home",zip:g,country:w},h&&(A.billingAddress.street=h),_&&(A.billingAddress.street2=_),f&&(A.billingAddress.city=f),E&&(A.billingAddress.state=E),T&&(A.billingAddress.phone=T)),n.settings.use_external_simulator&&s.test_mode&&(A.simulator="EXTERNAL"),n.shippingAddress&&(A.shippingAddress=n.shippingAddress);let P=null;paysafe.checkout.setup(s.authorization,A,(function(e,a,n){if(n&&n.paymentHandleToken){const a={orderId:o,paymentMethod:n.paymentMethod,transactionType:n.transactionType,paymentHandleToken:n.paymentHandleToken,amount:n.amount,customerOperation:n.customerOperation,merchantRefNum:A.merchantRefNum,nonce:s.nonce};fetch(s.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(a)}).then((e=>e.json())).then((a=>{"success"===a.status?e.showSuccessScreen((0,t.__)("Your goods are now purchased. Expect them to be delivered in next 5 business days.","paysafe-checkout")):e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")),P=a.redirect_url})).catch((a=>{i(l,(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))}else{let s="";a&&(a.code&&(s+=a.code+" "),a.message&&(s+=a.message+" "),a.detailedMessage&&(s+=a.detailedMessage)),e?(i(l,(0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout")+" "+s,{pace:3}),e.showFailureScreen((0,t.__)("The payment was declined. Please, try again with the same or another payment method. "+s,"paysafe-checkout"))):(p=(0,t.__)("The payment was declined. Please, try again with the same or another payment method.","paysafe-checkout"),a&&a.code&&a.detailedMessage&&(p+="<br /> "+a.code+" "+a.detailedMessage),i(l,p,[]),function(e){let t=document.getElementsByClassName("woocommerce-error");if(t=t.length>0?t[0]:null,!t){let e=document.getElementsByClassName("woocommerce-notices-wrapper"),a=e.length>0?e[0]:null;a&&(t=document.createElement("ul"),t.className="woocommerce-error",a.appendChild(t))}if(t){let a=document.createElement("li");a.setAttribute("id","paysafe-fatal-error-message"),a.innerHTML=e,t.appendChild(a),window.scrollTo({top:0,left:0,behavior:"smooth"})}}(p))}}),(function(e,t){if(e)switch(e){case"PAYMENT_HANDLE_NOT_CREATED":window.location.reload();break;case"PAYMENT_HANDLE_CREATED":case"PAYMENT_HANDLE_REDIRECT":case"PAYMENT_HANDLE_PAYABLE":if(null!==P)return void(window.location=P);window.location.reload()}else window.location.reload()}),(function(e,a,s){a===d?e.accept():(i(l,(0,t.__)("Amount is not the value expected","paysafe-checkout"),[]),e.decline((0,t.__)("Amount is not the value expected","paysafe-checkout")))}))}return e}const r="paysafepaypal",l=(0,s.getSetting)(r+"_data",{});let p={},d=!1;const m=a=>{const{eventRegistration:s,emitResponse:r}=a,{onPaymentSetup:m,onCheckoutSuccess:u}=s;return d||(d=!0,setTimeout((()=>{let e=document.getElementById("paysafepaypal_consumeridInput");e&&(e.value=l.consumer_id)}),100)),(0,n.useEffect)((()=>{const e=m((async()=>{let e=document.getElementById("paysafepaypal_consumeridInput");return e&&e.value&&e.value.length?{type:r.responseTypes.SUCCESS}:(i((0,t.__)("The payment process failed. You have to specify your PayPal email address!","paysafe-checkout"),{}),{type:r.responseTypes.ERROR,message:(0,t.__)("The payment process failed. You have to specify your PayPal email address!","paysafe-checkout")})}));return()=>{e()}}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,m]),(0,n.useEffect)((()=>{const e=u((e=>{let t=document.getElementById("paysafepaypal_consumeridInput"),a=t&&t.value&&t.value.length?t.value:"";return c(e,p,l,{transactionSource:"WooCommerceCheckout",displayPaymentMethods:["paypal"],paymentMethodDetails:{paypal:{accountId:l.account_id,consumerId:a}}})}));return()=>{e()}}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,"",[],u]),function(a,s=""){let n=[(0,e.createElement)("div",null,(0,o.decodeEntities)(a.description||""))];return a.test_mode&&(n.push((0,e.createElement)("hr",null)),n.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"10px"}},(0,e.createElement)("span",null,(0,t.__)("Paysafe Checkout is in TEST mode. Use the built-in simulator to test payments.","paysafe-checkout"))))),s&&n.push(s),n}(l,(0,e.createElement)("div",{id:"paysafe-hosted-payment-form",className:"paysafe-hosted-payment-form"},(0,e.createElement)("label",{id:"paysafepaypal_consumerid_label",className:"paysafe-general-form-label",htmlFor:"paysafepaypal_consumeridInput"},(0,t.__)("PayPal email address","paysafe-checkout")),(0,e.createElement)("div",{id:"paysafepaypal_consumerid",className:"paysafe-input-field"},(0,e.createElement)("input",{type:"text",className:"paysafe-input-field-input",name:"paysafepaypal_consumerid_input",id:"paysafepaypal_consumeridInput",placeholder:(0,t.__)("Your PayPal email address","paysafe-checkout"),min:"2",minLength:"2",max:"50",maxLength:"50"})),(0,e.createElement)("p",{id:"paysafepaypal_consumerid_spacer",className:"paysafe-general-form-spacer"},(0,t.__)("Enter the email from your PayPal account","paysafe-checkout"))))},u={name:r,paymentMethodId:r,label:function(a,s){const n=(0,o.decodeEntities)(a)||(0,t.__)("Paysafe Checkout","paysafe-checkout");return(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,n),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:s,alt:n}))}(l.title,l.icon),content:(0,e.createElement)(m,null),edit:(0,e.createElement)(m,null),canMakePayment:e=>(p=e,!0),ariaLabel:(0,t.__)("Paysafe Checkout","paysafe-checkout"),supports:{features:l.supports}};(0,a.registerPaymentMethod)(u)})();