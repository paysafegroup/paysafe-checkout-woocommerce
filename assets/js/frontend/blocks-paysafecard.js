(()=>{"use strict";const e=window.React,n=window.wp.i18n,a=window.wc.wcBlocksRegistry,t=window.wc.wcSettings,s=window.wp.element,c=window.wp.htmlEntities;function o(e,n,a){e&&fetch(e,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({message:n,context:a})}).catch((e=>{}))}function d(e,a,t,s){void 0===s&&(s={}),void 0===s.settings&&(s.settings={});const c=e.orderId,d=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",i=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"",r=!0===t.log_errors&&t.log_error_endpoint||null;let l=null,p=parseInt(a.cartTotals.total_price);if(!c||!p)return o(r,(0,n.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),{type:emitResponse.responseTypes.ERROR,message:(0,n.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")};{let e=a.cartTotals.currency_code,f=a.billingAddress.first_name,b=a.billingAddress.last_name,m=a.billingAddress.email,u=a.billingAddress.address_1,h=a.billingAddress.address_2,x=a.billingAddress.city,y=a.billingAddress.postcode,g=a.billingAddress.state,_=a.billingAddress.country,w=s&&s.additional&&s.additional.phone?s.additional.phone:a.billingAddress.phone||"";const E={transactionSource:s.transactionSource,amount:p,transactionType:"PAYMENT",currency:e,merchantRefNum:i,environment:t.test_mode?"TEST":"LIVE",displayPaymentMethods:s.displayPaymentMethods,paymentMethodDetails:s.paymentMethodDetails,threeDs:{merchantUrl:t.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"},locale:t.locale};t.merchant_descriptor&&t.merchant_phone&&(E.merchantDescriptor={dynamicDescriptor:t.merchant_descriptor,phone:t.merchant_phone}),d&&(E.singleUseCustomerToken=d,s.customer&&(E.customer=s.customer)),d&&!s.settings.add_customer_when_single_use_token||(s.customer?E.customer=s.customer:E.customer={firstName:f,lastName:b,email:m}),d&&!s.settings.add_billing_when_single_use_token||(E.billingAddress={nickName:"Home",zip:y,country:_},u&&(E.billingAddress.street=u),h&&(E.billingAddress.street2=h),x&&(E.billingAddress.city=x),g&&(E.billingAddress.state=g),w&&(E.billingAddress.phone=w)),s.shippingAddress&&(E.shippingAddress=s.shippingAddress);let A=null;paysafe.checkout.setup(t.authorization,E,(function(e,a,s){if(s&&s.paymentHandleToken){const a={orderId:c,paymentMethod:s.paymentMethod,transactionType:s.transactionType,paymentHandleToken:s.paymentHandleToken,amount:s.amount,customerOperation:s.customerOperation,merchantRefNum:E.merchantRefNum,nonce:t.nonce};fetch(t.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(a)}).then((e=>e.json())).then((a=>{"success"===a.status?e.showSuccessScreen((0,n.__)("Your goods are now purchased. Expect them to be delivered in next 5 business days.","paysafe-checkout")):e.showFailureScreen((0,n.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")),A=a.redirect_url})).catch((a=>{o(r,(0,n.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),e.showFailureScreen((0,n.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))}else{let t="";a&&(a.code&&(t+=a.code+" "),a.message&&(t+=a.message+" "),a.detailedMessage&&(t+=a.detailedMessage)),e?(o(r,(0,n.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout")+" "+t,{pace:3}),e.showFailureScreen((0,n.__)("The payment was declined. Please, try again with the same or another payment method. "+t,"paysafe-checkout"))):(l=(0,n.__)("The payment was declined. Please, try again with the same or another payment method.","paysafe-checkout"),a&&a.code&&a.detailedMessage&&(l+="<br /> "+a.code+" "+a.detailedMessage),o(r,l,[]),function(e){let n=document.getElementsByClassName("woocommerce-error");if(n=n.length>0?n[0]:null,!n){let e=document.getElementsByClassName("woocommerce-notices-wrapper"),a=e.length>0?e[0]:null;a&&(n=document.createElement("ul"),n.className="woocommerce-error",a.appendChild(n))}if(n){let a=document.createElement("li");a.setAttribute("id","paysafe-fatal-error-message"),a.innerHTML=e,n.appendChild(a),window.scrollTo({top:0,left:0,behavior:"smooth"})}}(l))}}),(function(e,n){if(e)switch(e){case"PAYMENT_HANDLE_NOT_CREATED":window.location.reload();break;case"PAYMENT_HANDLE_CREATED":case"PAYMENT_HANDLE_REDIRECT":case"PAYMENT_HANDLE_PAYABLE":if(null!==A)return void(window.location=A);window.location.reload()}else window.location.reload()}),(function(e,a,t){a===p?e.accept():(o(r,(0,n.__)("Amount is not the value expected","paysafe-checkout"),[]),e.decline((0,n.__)("Amount is not the value expected","paysafe-checkout")))}))}return e}const i="paysafecard",r=(0,t.getSetting)(i+"_data",{});let l={};const p=a=>{const{eventRegistration:t,emitResponse:o}=a,{onCheckoutSuccess:i}=t;return(0,s.useEffect)((()=>{const e=i((e=>{let n=r.consumer_id_encrypted;return n||(n=function(e){const n=(1n<<64n)-1n,a=[0x6a09e667f3bcc908n,0xbb67ae8584caa73bn,0x3c6ef372fe94f82bn,0xa54ff53a5f1d36f1n,0x510e527fade682d1n,0x9b05688c2b3e6c1fn,0x1f83d9abfb41bd6bn,0x5be0cd19137e2179n],t=[0x428a2f98d728ae22n,0x7137449123ef65cdn,0xb5c0fbcfec4d3b2fn,0xe9b5dba58189dbbcn,0x3956c25bf348b538n,0x59f111f1b605d019n,0x923f82a4af194f9bn,0xab1c5ed5da6d8118n,0xd807aa98a3030242n,0x12835b0145706fben,0x243185be4ee4b28cn,0x550c7dc3d5ffb4e2n,0x72be5d74f27b896fn,0x80deb1fe3b1696b1n,0x9bdc06a725c71235n,0xc19bf174cf692694n,0xe49b69c19ef14ad2n,0xefbe4786384f25e3n,0x0fc19dc68b8cd5b5n,0x240ca1cc77ac9c65n,0x2de92c6f592b0275n,0x4a7484aa6ea6e483n,0x5cb0a9dcbd41fbd4n,0x76f988da831153b5n,0x983e5152ee66dfabn,0xa831c66d2db43210n,0xb00327c898fb213fn,0xbf597fc7beef0ee4n,0xc6e00bf33da88fc2n,0xd5a79147930aa725n,0x06ca6351e003826fn,0x142929670a0e6e70n,0x27b70a8546d22ffcn,0x2e1b21385c26c926n,0x4d2c6dfc5ac42aedn,0x53380d139d95b3dfn,0x650a73548baf63den,0x766a0abb3c77b2a8n,0x81c2c92e47edaee6n,0x92722c851482353bn,0xa2bfe8a14cf10364n,0xa81a664bbc423001n,0xc24b8b70d0f89791n,0xc76c51a30654be30n,0xd192e819d6ef5218n,0xd69906245565a910n,0xf40e35855771202an,0x106aa07032bbd1b8n,0x19a4c116b8d2d0c8n,0x1e376c085141ab53n,0x2748774cdf8eeb99n,0x34b0bcb5e19b48a8n,0x391c0cb3c5c95a63n,0x4ed8aa4ae3418acbn,0x5b9cca4f7763e373n,0x682e6ff3d6b2b8a3n,0x748f82ee5defb2fcn,0x78a5636f43172f60n,0x84c87814a1f0ab72n,0x8cc702081a6439ecn,0x90befffa23631e28n,0xa4506cebde82bde9n,0xbef9a3f7b2c67915n,0xc67178f2e372532bn,0xca273eceea26619cn,0xd186b8c721c0c207n,0xeada7dd6cde0eb1en,0xf57d4f7fee6ed178n,0x06f067aa72176fban,0x0a637dc5a2c898a6n,0x113f9804bef90daen,0x1b710b35131c471bn,0x28db77f523047d84n,0x32caab7b40c72493n,0x3c9ebe0a15c9bebcn,0x431d67c49c100d4cn,0x4cc5d4becb3e42b6n,0x597f299cfc657e2an,0x5fcb6fab3ad6faecn,0x6c44198c4a475817n],s=(e,a)=>(e>>BigInt(a)|e<<BigInt(64-a))&n,c=(e,n)=>e>>BigInt(n),o=(e,n,a)=>e&n^~e&a,d=(e,n,a)=>e&n^e&a^n&a,i=e=>s(e,28)^s(e,34)^s(e,39),r=e=>s(e,14)^s(e,18)^s(e,41),l=e=>s(e,1)^s(e,8)^c(e,7),p=Array.from((new TextEncoder).encode(e)),f=8n*BigInt(p.length);for(p.push(128);p.length%128!=112;)p.push(0);const b=f>>64n,m=f&n;for(let e=7;e>=0;e--)p.push(Number(b>>BigInt(8*e)&0xffn));for(let e=7;e>=0;e--)p.push(Number(m>>BigInt(8*e)&0xffn));for(let e=0;e<p.length;e+=128){const f=new Array(80).fill(0n);for(let n=0;n<16;n++){let a=0n;for(let t=0;t<8;t++)a=a<<8n|BigInt(p[e+8*n+t]);f[n]=a}for(let e=16;e<80;e++)f[e]=(u=f[e-2],(s(u,19)^s(u,61)^c(u,6))+f[e-7]+l(f[e-15])+f[e-16]&n);let[b,m,h,x,y,g,_,w]=a;for(let e=0;e<80;e++){const a=w+r(y)+o(y,g,_)+t[e]+f[e]&n,s=i(b)+d(b,m,h)&n;w=_,_=g,g=y,y=x+a&n,x=h,h=m,m=b,b=a+s&n}a[0]=a[0]+b&n,a[1]=a[1]+m&n,a[2]=a[2]+h&n,a[3]=a[3]+x&n,a[4]=a[4]+y&n,a[5]=a[5]+g&n,a[6]=a[6]+_&n,a[7]=a[7]+w&n}var u;return a.map((e=>e.toString(16).padStart(16,"0"))).join("").substring(0,50)}(l.billingAddress.email)),d(e,l,r,{transactionSource:"WooCommerceCheckout",displayPaymentMethods:["paysafecard"],paymentMethodDetails:{paysafecard:{accountId:r.account_id,consumerId:n}}})}));return()=>{e()}}),[o.responseTypes.ERROR,o.responseTypes.SUCCESS,"",[],i]),function(a,t=""){let s=[(0,e.createElement)("div",null,(0,c.decodeEntities)(a.description||""))];return a.test_mode&&(s.push((0,e.createElement)("hr",null)),s.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"10px"}},(0,e.createElement)("span",null,(0,n.__)("Paysafe Checkout is in TEST mode. Use the built-in simulator to test payments.","paysafe-checkout"))))),t&&s.push(t),s}(r)},f={name:i,paymentMethodId:i,label:function(a,t){const s=(0,c.decodeEntities)(a)||(0,n.__)("Paysafe Checkout","paysafe-checkout");return(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,s),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:t,alt:s}))}(r.title,r.icon),content:(0,e.createElement)(p,null),edit:(0,e.createElement)(p,null),canMakePayment:e=>(l=e,!0),ariaLabel:(0,n.__)("Paysafe Checkout","paysafe-checkout"),supports:{features:r.supports}};(0,a.registerPaymentMethod)(f)})();