(()=>{"use strict";const e=window.React,t=window.wp.i18n,s=window.wc.wcBlocksRegistry,n=window.wc.wcSettings,a=window.wp.element,o=window.wp.htmlEntities;function i(e,t,s){e&&fetch(e,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({message:t,context:s})}).catch((e=>{}))}function c(e,s,n,a){void 0===a&&(a={}),void 0===a.settings&&(a.settings={});const o=e.orderId,c=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",r=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"",l=!0===n.log_errors&&n.log_error_endpoint||null;let d=null,p=parseInt(s.cartTotals.total_price);if(!o||!p)return i(l,(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),{type:emitResponse.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")};{let e=s.cartTotals.currency_code,m=s.billingAddress.first_name,u=s.billingAddress.last_name,h=s.billingAddress.email,y=s.billingAddress.address_1,g=s.billingAddress.address_2,_=s.billingAddress.city,f=s.billingAddress.postcode,w=s.billingAddress.state,E=s.billingAddress.country,T=a&&a.additional&&a.additional.phone?a.additional.phone:s.billingAddress.phone||"";const A={transactionSource:a.transactionSource,amount:p,transactionType:"PAYMENT",currency:e,merchantRefNum:r,environment:n.test_mode?"TEST":"LIVE",displayPaymentMethods:a.displayPaymentMethods,paymentMethodDetails:a.paymentMethodDetails,threeDs:{merchantUrl:n.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"},locale:n.locale};n.merchant_descriptor&&n.merchant_phone&&(A.merchantDescriptor={dynamicDescriptor:n.merchant_descriptor,phone:n.merchant_phone}),c&&(A.singleUseCustomerToken=c,a.customer&&(A.customer=a.customer)),c&&!a.settings.add_customer_when_single_use_token||(a.customer?A.customer=a.customer:A.customer={firstName:m,lastName:u,email:h}),c&&!a.settings.add_billing_when_single_use_token||(A.billingAddress={nickName:"Home",zip:f,country:E},y&&(A.billingAddress.street=y),g&&(A.billingAddress.street2=g),_&&(A.billingAddress.city=_),w&&(A.billingAddress.state=w),T&&(A.billingAddress.phone=T)),a.shippingAddress&&(A.shippingAddress=a.shippingAddress);let k=null;paysafe.checkout.setup(n.authorization,A,(function(e,s,a){if(a&&a.paymentHandleToken){const s={orderId:o,paymentMethod:a.paymentMethod,transactionType:a.transactionType,paymentHandleToken:a.paymentHandleToken,amount:a.amount,customerOperation:a.customerOperation,merchantRefNum:A.merchantRefNum,nonce:n.nonce};fetch(n.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(s)}).then((e=>e.json())).then((s=>{"success"===s.status?e.showSuccessScreen((0,t.__)("Your goods are now purchased. Expect them to be delivered in next 5 business days.","paysafe-checkout")):e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")),k=s.redirect_url})).catch((s=>{i(l,(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))}else{let n="";s&&(s.code&&(n+=s.code+" "),s.message&&(n+=s.message+" "),s.detailedMessage&&(n+=s.detailedMessage)),e?(i(l,(0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout")+" "+n,{pace:3}),e.showFailureScreen((0,t.__)("The payment was declined. Please, try again with the same or another payment method. "+n,"paysafe-checkout"))):(d=(0,t.__)("The payment was declined. Please, try again with the same or another payment method.","paysafe-checkout"),s&&s.code&&s.detailedMessage&&(d+="<br /> "+s.code+" "+s.detailedMessage),i(l,d,[]),function(e){let t=document.getElementsByClassName("woocommerce-error");if(t=t.length>0?t[0]:null,!t){let e=document.getElementsByClassName("woocommerce-notices-wrapper"),s=e.length>0?e[0]:null;s&&(t=document.createElement("ul"),t.className="woocommerce-error",s.appendChild(t))}if(t){let s=document.createElement("li");s.setAttribute("id","paysafe-fatal-error-message"),s.innerHTML=e,t.appendChild(s),window.scrollTo({top:0,left:0,behavior:"smooth"})}}(d))}}),(function(e,t){if(e)switch(e){case"PAYMENT_HANDLE_NOT_CREATED":window.location.reload();break;case"PAYMENT_HANDLE_CREATED":case"PAYMENT_HANDLE_REDIRECT":case"PAYMENT_HANDLE_PAYABLE":if(null!==k)return void(window.location=k);window.location.reload()}else window.location.reload()}),(function(e,s,n){s===p?e.accept():(i(l,(0,t.__)("Amount is not the value expected","paysafe-checkout"),[]),e.decline((0,t.__)("Amount is not the value expected","paysafe-checkout")))}))}return e}const r="eft",l=(0,n.getSetting)(r+"_data",{});let d={};const p=s=>{const{eventRegistration:n,emitResponse:i}=s,{onCheckoutSuccess:r}=n;return(0,a.useEffect)((()=>{const e=r((e=>c(e,d,l,{transactionSource:"WooCommerceCheckout",displayPaymentMethods:["eft"],paymentMethodDetails:{eft:{accountId:l.account_id}}})));return()=>{e()}}),[i.responseTypes.ERROR,i.responseTypes.SUCCESS,"",[],r]),function(s,n=""){let a=[(0,e.createElement)("div",null,(0,o.decodeEntities)(s.description||""))];return s.test_mode&&(a.push((0,e.createElement)("hr",null)),a.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"10px"}},(0,e.createElement)("span",null,(0,t.__)("Paysafe Checkout is in TEST mode. Use the built-in simulator to test payments.","paysafe-checkout"))))),n&&a.push(n),a}(l)},m={name:r,paymentMethodId:r,label:function(s,n){const a=(0,o.decodeEntities)(s)||(0,t.__)("Paysafe Checkout","paysafe-checkout");return(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,a),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:n,alt:a}))}(l.title,l.icon),content:(0,e.createElement)(p,null),edit:(0,e.createElement)(p,null),canMakePayment:e=>(d=e,!0),ariaLabel:(0,t.__)("Paysafe Checkout","paysafe-checkout"),supports:{features:l.supports}};(0,s.registerPaymentMethod)(m)})();