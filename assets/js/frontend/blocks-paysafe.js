(()=>{"use strict";const e=window.React,t=window.wp.i18n,a=window.wc.wcBlocksRegistry,s=window.wp.htmlEntities,n=window.wc.wcSettings,o=window.wp.element,r="paysafe",c=(0,n.getSetting)("paysafe_data",{}),i=function(e,t){!0===c.log_errors&&c.log_error_endpoint&&fetch(c.log_error_endpoint,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({message:e,context:t})}).catch((e=>{}))},l="paysafe_js"===c.integration_type;let p=!!c.cvv_verification;const d=(0,s.decodeEntities)(c.title)||"Paysafe Checkout";c.icon;let m=0,u={},y=null;const h=function(e,t){let a=document.getElementsByClassName("woocommerce-error");if(a=a.length>0?a[0]:null,!a){let e=document.getElementsByClassName("woocommerce-notices-wrapper"),t=e.length>0?e[0]:null;t&&(a=document.createElement("ul"),a.className="woocommerce-error",t.appendChild(a))}if(a){let s=document.getElementById("paysafe-fatal-error-message");!s||t?(s=document.createElement("li"),s.setAttribute("id","paysafe-fatal-error-message"),s.innerHTML=e,a.appendChild(s),window.scrollTo({top:0,left:0,behavior:"smooth"})):s.innerHTML=e}};let f;const _=function(){if(!jQuery("#paysafe-hosted-payment-form").length)return;if("undefined"==typeof paysafe||void 0===paysafe.fields)return void setTimeout((function(){_()}),1e3);E=!1;const e={currencyCode:c.currency_code,environment:c.test_mode?"TEST":"LIVE",transactionSource:"WooCommerceJs",fields:{cardNumber:{selector:"#cardNumber",placeholder:"Card number",separator:" "},expiryDate:{selector:"#expiryDate",placeholder:"MM/YY"},cvv:{selector:"#cvv",placeholder:"CVV",optional:!1}},style:{input:{"font-family":"sans-serif","font-weight":"normal","font-size":"16px"}},accounts:{default:c.account_id}};paysafe.fields.setup(c.authorization,e).then((e=>(f=e,e.show()))).then((e=>{e.card&&e.card.error})).catch((e=>{const t="ERROR "+e.code+": "+e.detailedMessage;i(t,[]),h(t)}))};let g=null,E=!1;const T=function(){if(!jQuery("#cvv-verification-container").length)return;if("undefined"==typeof paysafe||void 0===paysafe.fields)return void setTimeout((function(){T()}),1e3);E=!0,g=null;const e={currencyCode:c.currency_code,environment:c.test_mode?"TEST":"LIVE",transactionSource:"WooCommerceJs",fields:{cardNumber:{selector:"#cardNumber",placeholder:"Card number",separator:" ",optional:!0},expiryDate:{selector:"#expiryDate",placeholder:"MM/YY",optional:!0},cvv:{selector:"#cvv",placeholder:"CVV",optional:!p}},accounts:{default:c.account_id}};"undefined"!=typeof paysafe&&void 0!==paysafe.fields&&paysafe.fields.setup(c.authorization,e).then((e=>(g=e,e.show()))).then((e=>{e.card&&e.card.error})).catch((e=>{const t="ERROR "+e.code+": "+e.detailedMessage;i(t,[]),9073===parseInt(e.code)&&p&&(p=!1,T())}))},R=a=>{const{eventRegistration:n,emitResponse:r}=a,{onCheckoutSuccess:d,onPaymentSetup:g}=n;(0,o.useEffect)((()=>{p&&(E=!1),l&&_();const e=g((async e=>{if(l){if(f){if(f.areAllFieldsValid()){let e=document.getElementById("holderNameInput");return e&&e.value&&e.value.length&&e.value.length>=2&&e.value.length<=160?{type:r.responseTypes.SUCCESS}:(i((0,t.__)("The payment process failed. Card holder name must have between 2 and 160 characters!","paysafe-checkout"),{tokenization_stage:2}),{type:r.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Card holder name must have between 2 and 160 characters!","paysafe-checkout")})}return i((0,t.__)("The payment process failed. Card holder name must have between 2 and 160 characters!","paysafe-checkout"),{tokenization_stage:2}),{type:r.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please enter your card details and try again","paysafe-checkout")}}return i((0,t.__)("The payment process failed.","paysafe-checkout"),{tokenization_stage:3}),{type:r.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please reload the page and try again","paysafe-checkout")}}}));return()=>{e()}}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,g]),(0,o.useEffect)((()=>{const e=d((e=>{const a=e.orderId,s=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",n=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"";let o=null;if(m=parseInt(u.cartTotals.total_price),!a||!m)return i((0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout"),{pace:5}),{type:r.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")};{let e=u.cartTotals.currency_code,r=u.billingAddress.first_name,p=u.billingAddress.last_name,d=u.billingAddress.email,_=u.billingAddress.address_1,g=u.billingAddress.address_2,E=u.billingAddress.city,T=u.billingAddress.postcode,R=u.billingAddress.state,v=u.billingAddress.country,k=u.billingAddress.phone;if(l){let s={transactionSource:"WooCommerceJs",amount:m,transactionType:"PAYMENT",currency:e,merchantRefNum:n,environment:c.test_mode?"TEST":"LIVE",threeDs:{merchantUrl:c.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE",profile:{email:c.user_email}},paymentType:"CARD",accountId:c.account_id};c.merchant_descriptor&&c.merchant_phone&&(s.merchantDescriptor={dynamicDescriptor:c.merchant_descriptor,phone:c.merchant_phone}),s.customerDetails={holderName:r+" "+p,billingDetails:{nickName:"Home",zip:T,country:v},profile:{firstName:r,lastName:p,email:d,locale:c.locale,phone:k}};let o=document.getElementById("holderNameInput"),u=o&&o.value&&o.value.length&&o.value.length>=2&&o.value.length<=160?o.value:null;u&&(s.customerDetails.holderName=u),_&&(s.customerDetails.billingDetails.street=_),g&&(s.customerDetails.billingDetails.street2=g),E&&(s.customerDetails.billingDetails.city=E),R&&(s.customerDetails.billingDetails.state=R),k&&(s.customerDetails.billingDetails.phone=k),f.tokenize(s).then((e=>{if(!e||!e.token)throw"Result failure";const s={orderId:a,paymentMethod:"CARD",transactionType:"PAYMENT",paymentHandleToken:e.token,amount:m,customerOperation:"",merchantRefNum:n,nonce:c.nonce};let o=!1;if(l){let e=document.getElementById("paysafe_hosted_save_card");e&&e.checked&&(o=!0)}o&&(s.save_card=!0),fetch(c.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(s)}).then((e=>e.json())).then((e=>{("error"===e.status||e.error_message)&&h(e.error_message),window.location=e.redirect_url})).catch((e=>{const a="ERROR "+e.code+": "+e.detailedMessage;i(a,[]),h(a),h((0,t.__)("The payment process failed. Please reload the page and try again","paysafe-checkout"),!0)}))})).catch((e=>{const a="ERROR "+e.code+": "+e.detailedMessage;i(a,[]),h(a),h((0,t.__)("The payment process failed. Please reload the page and try again","paysafe-checkout"),!0)}))}else{const l={transactionSource:"WooCommerceCheckout",amount:m,transactionType:"PAYMENT",currency:e,merchantRefNum:n,environment:c.test_mode?"TEST":"LIVE",displayPaymentMethods:["card"],paymentMethodDetails:{card:{accountId:c.account_id}},threeDs:{merchantUrl:c.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"},locale:c.locale};c.merchant_descriptor&&c.merchant_phone&&(l.merchantDescriptor={dynamicDescriptor:c.merchant_descriptor,phone:c.merchant_phone}),s?l.singleUseCustomerToken=s:(l.customer={firstName:r,lastName:p,email:d},l.billingAddress={nickName:"Home",zip:T,country:v},_&&(l.billingAddress.street=_),g&&(l.billingAddress.street2=g),E&&(l.billingAddress.city=E),R&&(l.billingAddress.state=R)),paysafe.checkout.setup(c.authorization,l,(function(e,s,n){if(n&&n.paymentHandleToken){const s={orderId:a,paymentMethod:n.paymentMethod,transactionType:n.transactionType,paymentHandleToken:n.paymentHandleToken,amount:n.amount,customerOperation:n.customerOperation,merchantRefNum:l.merchantRefNum,nonce:c.nonce};fetch(c.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(s)}).then((e=>e.json())).then((a=>{"success"===a.status?e.showSuccessScreen((0,t.__)("Your goods are now purchased. Expect them to be delivered in next 5 business days.","paysafe-checkout")):(i((0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout"),{pace:1}),e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))),y=a.redirect_url})).catch((a=>{i((0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout"),{pace:2}),e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))}else{let a="";s&&(s.code&&(a+=s.code+" "),s.message&&(a+=s.message+" "),s.detailedMessage&&(a+=s.detailedMessage)),e?(i((0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout")+" "+a,{pace:3}),e.showFailureScreen((0,t.__)("The payment was declined. Please, try again with the same or another payment method. "+a,"paysafe-checkout"))):(o=(0,t.__)("The payment was declined. Please, try again with the same or another payment method.","paysafe-checkout"),s&&s.code&&s.detailedMessage&&(o+="<br /> "+s.code+" "+s.detailedMessage),i(o,{pace:4}),h(o))}}),(function(e,a){if(e)switch(e){case"PAYMENT_HANDLE_NOT_CREATED":i((0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout"),{stage:e,expired:a}),window.location.reload();break;case"PAYMENT_HANDLE_CREATED":case"PAYMENT_HANDLE_REDIRECT":case"PAYMENT_HANDLE_PAYABLE":if(null!==y)return void(window.location=y);window.location.reload()}else i((0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout"),{stage:e,expired:a}),window.location.reload()}),(function(e,a,s){a===m?e.accept():(i((0,t.__)("Amount is not the value expected","paysafe-checkout")),e.decline((0,t.__)("Amount is not the value expected","paysafe-checkout")))}))}}return e}));return()=>{e()}}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,"",[],d]);let T=[];return c.description&&T.push((0,e.createElement)("div",null,(0,s.decodeEntities)(c.description||""))),c.description&&c.test_mode&&T.push((0,e.createElement)("hr",null)),c.test_mode&&T.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"5px"}},(0,e.createElement)("span",null,(0,t.__)("Paysafe Checkout is in TEST MODE. Use the test Visa card 4000000000001091 with any expiry date, CVC, email, or OTP token. Important notice: Please use only TEST CARDS for testing. You can find other test cards ","paysafe-checkout")),(0,e.createElement)("a",{href:"https://developer.paysafe.com/en/api-docs/cards/test-and-go-live/test-cards/",target:"_blank"},(0,t.__)("here. ","paysafe-checkout")," "))),c.test_mode&&l&&T.push((0,e.createElement)("p",null)),l?T.push(wp.element.RawHTML({children:c.integration_hosted_form})):c.is_subscription_payment&&T.push((0,e.createElement)("p",{style:{fontSize:"0.8em",marginBottom:"0"}},(0,e.createElement)("b",null,(0,t.__)("Note:","paysafe-checkout")),(0,t.__)("This order includes a subscription.","paysafe-checkout"),(0,t.__)("By proceeding with payment, your card details will be securely saved for future recurring payments.","paysafe-checkout"),(0,e.createElement)("br",null),(0,t.__)("Card data is stored and processed securely by Paysafe in compliance with PCI DSS standards and according to the merchant’s","paysafe-checkout")," ",(0,t.__)("Terms and Conditions","paysafe-checkout")," ",(0,t.__)("and","paysafe-checkout")," ",(0,t.__)("Privacy Policy.","paysafe-checkout"))),T},v={name:r,paymentMethodId:r,label:(0,e.createElement)((()=>(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,d),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:c.icon,alt:d}))),null),content:(0,e.createElement)(R,null),edit:(0,e.createElement)(R,null),savedTokenComponent:(0,e.createElement)((a=>{const{eventRegistration:s,emitResponse:n}=a,{onCheckoutSuccess:r,onPaymentSetup:l}=s;return(0,o.useEffect)((()=>{E||(E=!0,T());const e=l((()=>{if(p){if(!g)return i((0,t.__)("The payment process failed.","paysafe-checkout"),{tokenization_stage:3}),{type:n.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please reload the page and try again","paysafe-checkout")};if(!g.areAllFieldsValid())return i((0,t.__)("The payment process failed. No CVV entered","paysafe-checkout"),{tokenization_stage:2}),{type:n.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please enter your saved card CVV and try again","paysafe-checkout")}}}));return()=>{e()}}),[n.responseTypes.ERROR,n.responseTypes.SUCCESS,l]),(0,o.useEffect)((()=>{const e=r((e=>{const a=e.orderId;if(m=parseInt(u.cartTotals.total_price),a&&m){const s=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",o=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.paysafe_token?e.processingResponse.paymentDetails.paysafe_token:"",r=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"",l=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.redirect?e.processingResponse.paymentDetails.redirect:null;if(l)return window.location=l,{type:n.responseTypes.SUCCESS};let p=u.cartTotals.currency_code,d=u.billingAddress.first_name,y=u.billingAddress.last_name,f=u.billingAddress.email,_=u.billingAddress.address_1,E=u.billingAddress.address_2,T=u.billingAddress.city,R=u.billingAddress.postcode,v=u.billingAddress.state,k=u.billingAddress.country,w=u.billingAddress.phone,N={transactionSource:"WooCommerceJs",amount:m,transactionType:"PAYMENT",currency:p,merchantRefNum:r,environment:c.test_mode?"TEST":"LIVE",threeDs:{merchantUrl:c.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE",profile:{email:c.user_email}},paymentType:"CARD",accountId:c.account_id,singleUseCustomerToken:s,paymentTokenFrom:o};c.merchant_descriptor&&c.merchant_phone&&(N.merchantDescriptor={dynamicDescriptor:c.merchant_descriptor,phone:c.merchant_phone}),N.customerDetails={holderName:d+" "+y,billingDetails:{nickName:"Home",zip:R,country:k},profile:{firstName:d,lastName:y,email:f,locale:c.locale,phone:w}},_&&(N.customerDetails.billingDetails.street=_),E&&(N.customerDetails.billingDetails.street2=E),T&&(N.customerDetails.billingDetails.city=T),v&&(N.customerDetails.billingDetails.state=v),w&&(N.customerDetails.billingDetails.phone=w),g.tokenize(N).then((e=>{if(!e||!e.token)throw"Result failure";const s={orderId:a,paymentMethod:"CARD",transactionType:"PAYMENT",paymentHandleToken:e.token,amount:m,customerOperation:"",merchantRefNum:r,nonce:c.nonce};fetch(c.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(s)}).then((e=>e.json())).then((e=>{e.error_message?(i(e.error_message,{tokenization_stage:1}),h(e.error_message),h((0,t.__)("The payment process failed. Please reload the page and try again","paysafe-checkout"),!0)):window.location=e.redirect_url})).catch((e=>{i((0,t.__)("The payment process failed.","paysafe-checkout"),{tokenization_stage:1}),h((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))})).catch((e=>{const a="ERROR "+e.code+": "+e.detailedMessage;i(a,[]),h(a),h((0,t.__)("The payment process failed. Please reload the page and try again","paysafe-checkout"),!0)}))}return e}));return()=>{e()}}),[n.responseTypes.ERROR,n.responseTypes.SUCCESS,"",[],r]),p&&"undefined"!=typeof paysafe&&void 0!==paysafe.fields?[(0,e.createElement)("div",{id:"cvv-verification-container"},(0,e.createElement)("b",null,(0,t.__)("CVV","paysafe-checkout")),(0,e.createElement)("div",{id:"holderName",className:"paysafe-input-field optional-field",style:{display:"none"}}),(0,e.createElement)("div",{id:"cardNumber",className:"paysafe-input-field optional-field",style:{display:"none"}}),(0,e.createElement)("div",{id:"expiryDate",className:"paysafe-input-field optional-field",style:{display:"none"}}),(0,e.createElement)("div",{className:"paysafe-cc-form-exp-cvv-row"},(0,e.createElement)("div",{className:"paysafe-cc-form-exp-cvv-box1"}),(0,e.createElement)("div",{className:"paysafe-cc-form-exp-cvv-box2"},(0,e.createElement)("div",{id:"cvv",className:"paysafe-input-field"})),(0,e.createElement)("div",{className:"paysafe-cc-form-exp-cvv-box3"},(0,e.createElement)("img",{className:"paysafe-cc-form-cvv-image",src:c.paysafe_base_url+"assets/img/cvv.svg",alt:"CVV"}))))]:[(0,e.createElement)("div",{id:"cvv-verification-container"},(0,e.createElement)("div",{id:"holderName",className:"paysafe-input-field optional-field"}),(0,e.createElement)("div",{id:"cardNumber",className:"paysafe-input-field optional-field"}),(0,e.createElement)("div",{id:"expiryDate",className:"paysafe-input-field optional-field"}),(0,e.createElement)("div",{id:"cvv",className:"paysafe-input-field optional-field"}))]}),null),canMakePayment:e=>(u=e,!0),ariaLabel:d,supports:{features:c.supports}};(0,a.registerPaymentMethod)(v)})();