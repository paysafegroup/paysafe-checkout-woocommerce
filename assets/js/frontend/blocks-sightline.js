(()=>{"use strict";const e=window.React,t=window.wp.i18n,s=window.wc.wcBlocksRegistry,n=window.wc.wcSettings,a=window.wp.element,i=window.wp.htmlEntities;function o(e,t,s){e&&fetch(e,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({message:t,context:s})}).catch((e=>{}))}function r(e,s,n,a){void 0===a&&(a={}),void 0===a.settings&&(a.settings={});const i=e.orderId,r=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.single_use_token?e.processingResponse.paymentDetails.single_use_token:"",l=e&&e.processingResponse&&e.processingResponse.paymentDetails&&e.processingResponse.paymentDetails.merch_ref_num?e.processingResponse.paymentDetails.merch_ref_num:"",c=!0===n.log_errors&&n.log_error_endpoint||null;let d=null,p=parseInt(s.cartTotals.total_price);if(!i||!p)return o(c,(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),{type:emitResponse.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")};{let e=s.cartTotals.currency_code,m=s.billingAddress.first_name,u=s.billingAddress.last_name,h=s.billingAddress.email,y=s.billingAddress.address_1,g=s.billingAddress.address_2,_=s.billingAddress.city,f=s.billingAddress.postcode,E=s.billingAddress.state,w=s.billingAddress.country,A=a&&a.additional&&a.additional.phone?a.additional.phone:s.billingAddress.phone||"";const T={transactionSource:a.transactionSource,amount:p,transactionType:"PAYMENT",currency:e,merchantRefNum:l,environment:n.test_mode?"TEST":"LIVE",displayPaymentMethods:a.displayPaymentMethods,paymentMethodDetails:a.paymentMethodDetails,threeDs:{merchantUrl:n.checkout_url,deviceChannel:"BROWSER",messageCategory:"PAYMENT",authenticationPurpose:"PAYMENT_TRANSACTION",transactionIntent:"GOODS_OR_SERVICE_PURCHASE"},locale:n.locale};n.merchant_descriptor&&n.merchant_phone&&(T.merchantDescriptor={dynamicDescriptor:n.merchant_descriptor,phone:n.merchant_phone}),r&&(T.singleUseCustomerToken=r,a.customer&&(T.customer=a.customer)),r&&!a.settings.add_customer_when_single_use_token||(a.customer?T.customer=a.customer:T.customer={firstName:m,lastName:u,email:h}),r&&!a.settings.add_billing_when_single_use_token||(T.billingAddress={nickName:"Home",zip:f,country:w},y&&(T.billingAddress.street=y),g&&(T.billingAddress.street2=g),_&&(T.billingAddress.city=_),E&&(T.billingAddress.state=E),A&&(T.billingAddress.phone=A)),a.shippingAddress&&(T.shippingAddress=a.shippingAddress);let b=null;paysafe.checkout.setup(n.authorization,T,(function(e,s,a){if(a&&a.paymentHandleToken){const s={orderId:i,paymentMethod:a.paymentMethod,transactionType:a.transactionType,paymentHandleToken:a.paymentHandleToken,amount:a.amount,customerOperation:a.customerOperation,merchantRefNum:T.merchantRefNum,nonce:n.nonce};fetch(n.register_url,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(s)}).then((e=>e.json())).then((s=>{"success"===s.status?e.showSuccessScreen((0,t.__)("Your goods are now purchased. Expect them to be delivered in next 5 business days.","paysafe-checkout")):e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout")),b=s.redirect_url})).catch((s=>{o(c,(0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"),[]),e.showFailureScreen((0,t.__)("The payment process failed. Please close this popup and try again","paysafe-checkout"))}))}else{let n="";s&&(s.code&&(n+=s.code+" "),s.message&&(n+=s.message+" "),s.detailedMessage&&(n+=s.detailedMessage)),e?(o(c,(0,t.__)("Payment failed. Popup was closed without a correct end message!","paysafe-checkout")+" "+n,{pace:3}),e.showFailureScreen((0,t.__)("The payment was declined. Please, try again with the same or another payment method. "+n,"paysafe-checkout"))):(d=(0,t.__)("The payment was declined. Please, try again with the same or another payment method.","paysafe-checkout"),s&&s.code&&s.detailedMessage&&(d+="<br /> "+s.code+" "+s.detailedMessage),o(c,d,[]),function(e){let t=document.getElementsByClassName("woocommerce-error");if(t=t.length>0?t[0]:null,!t){let e=document.getElementsByClassName("woocommerce-notices-wrapper"),s=e.length>0?e[0]:null;s&&(t=document.createElement("ul"),t.className="woocommerce-error",s.appendChild(t))}if(t){let s=document.createElement("li");s.setAttribute("id","paysafe-fatal-error-message"),s.innerHTML=e,t.appendChild(s),window.scrollTo({top:0,left:0,behavior:"smooth"})}}(d))}}),(function(e,t){if(e)switch(e){case"PAYMENT_HANDLE_NOT_CREATED":window.location.reload();break;case"PAYMENT_HANDLE_CREATED":case"PAYMENT_HANDLE_REDIRECT":case"PAYMENT_HANDLE_PAYABLE":if(null!==b)return void(window.location=b);window.location.reload()}else window.location.reload()}),(function(e,s,n){s===p?e.accept():(o(c,(0,t.__)("Amount is not the value expected","paysafe-checkout"),[]),e.decline((0,t.__)("Amount is not the value expected","paysafe-checkout")))}))}return e}const l="sightline",c=(0,n.getSetting)(l+"_data",{});let d={};const p=s=>{const{eventRegistration:n,emitResponse:l}=s,{onPaymentSetup:p,onCheckoutSuccess:m}=n;return(0,a.useEffect)((()=>{const e=p((async()=>{let e=document.getElementById("sightline_consumeridInput");return e&&e.value&&e.value.length&&e.value.length>=2&&e.value.length<=50?{type:l.responseTypes.SUCCESS}:(o((0,t.__)("The payment process failed. Play+ (Sightline) consumer id must have between 2 and 50 characters!","paysafe-checkout"),{}),{type:l.responseTypes.ERROR,message:(0,t.__)("The payment process failed. Play+ (Sightline) consumer id must have between 2 and 50 characters!","paysafe-checkout")})}));return()=>{e()}}),[l.responseTypes.ERROR,l.responseTypes.SUCCESS,p]),(0,a.useEffect)((()=>{const e=m((e=>{let t=document.getElementById("sightline_consumeridInput"),s=t&&t.value&&t.value.length&&t.value.length>=2&&t.value.length<=50?t.value:"";return r(e,d,c,{transactionSource:"WooCommerceCheckout",displayPaymentMethods:["sightline"],paymentMethodDetails:{sightline:{accountId:c.account_id,consumerId:""+s}},shippingAddress:{city:d.billingAddress.city,country:d.billingAddress.country,recipientName:d.billingAddress.first_name+" "+d.billingAddress.last_name,state:d.billingAddress.state,street:d.billingAddress.address_1,street2:d.billingAddress.address_2,zip:d.billingAddress.postcode}})}));return()=>{e()}}),[l.responseTypes.ERROR,l.responseTypes.SUCCESS,"",[],m]),function(s,n=""){let a=[(0,e.createElement)("div",null,(0,i.decodeEntities)(s.description||""))];return s.test_mode&&(a.push((0,e.createElement)("hr",null)),a.push((0,e.createElement)("div",{style:{textAlign:"justify",marginTop:"10px"}},(0,e.createElement)("span",null,(0,t.__)("Paysafe Checkout is in TEST mode. Use the built-in simulator to test payments.","paysafe-checkout"))))),n&&a.push(n),a}(c,(0,e.createElement)("div",{id:"paysafe-hosted-payment-form",className:"paysafe-hosted-payment-form"},(0,e.createElement)("label",{id:"sightline_consumerid_label",className:"paysafe-general-form-label",htmlFor:"sightline_consumeridInput"},(0,t.__)("Play+ (Sightline) Loyalty Membership Number","paysafe-checkout")),(0,e.createElement)("div",{id:"sightline_consumerid",className:"paysafe-input-field"},(0,e.createElement)("input",{type:"text",className:"paysafe-input-field-input",name:"sightline_consumerid_input",id:"sightline_consumeridInput",placeholder:(0,t.__)("Your Play+ (Sightline) Loyalty Membership Number","paysafe-checkout"),min:"2",minLength:"2",max:"50",maxLength:"50"})),(0,e.createElement)("p",{id:"sightline_consumerid_spacer",className:"paysafe-general-form-spacer"},(0,t.__)("Enter the Loyalty Membership Number from your Play+ (Sightline) account","paysafe-checkout"))))},m={name:l,paymentMethodId:l,label:function(s,n){const a=(0,i.decodeEntities)(s)||(0,t.__)("Paysafe Checkout","paysafe-checkout");return(0,e.createElement)("div",{className:"paysafe-gateway-title"},(0,e.createElement)("span",null,a),(0,e.createElement)("img",{className:"paysafe-gateway-image",src:n,alt:a}))}(c.title,c.icon),content:(0,e.createElement)(p,null),edit:(0,e.createElement)(p,null),canMakePayment:e=>(d=e,!0),ariaLabel:(0,t.__)("Paysafe Checkout","paysafe-checkout"),supports:{features:c.supports}};(0,s.registerPaymentMethod)(m)})();