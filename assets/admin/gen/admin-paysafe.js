(function(r,l,t){"use strict";const K=y=>{const m=y.match(/^payment_method_([A-Z]{3})_([A-Z0-9]+)(?:_(sandbox|live))?$/i);if(!m){const i=y.match(/^payment_method_([A-Z]{3})_([A-Z0-9_]+)_(sandbox|live)?$/i);return i?{currency:i[1],method:i[2],env:i[3]||null}:{currency:null,method:null,env:null}}return{currency:m[1],method:m[2],env:m[3]||null}};function C(y){try{return JSON.stringify(y,(i,_)=>_&&typeof _=="object"&&!Array.isArray(_)?Object.keys(_).sort().reduce((v,f)=>(v[f]=_[f],v),{}):_)}catch{return String(Math.random())}}const ue={general:t.__("General","paysafe-checkout"),account:t.__("Account Settings","paysafe-checkout"),shopping_experience:t.__("Shopping Experience","paysafe-checkout"),payment_methods:t.__("Payment Methods","paysafe-checkout"),shopping_features:t.__("WooCommerce Subscriptions","paysafe-checkout"),advanced:t.__("Advanced Settings","paysafe-checkout")},pe={general:React.createElement(React.Fragment,null,React.createElement("p",null,t.__("Enable or disable Paysafe payments.","paysafe-checkout")),React.createElement("p",null,t.__("If you enable test mode, the extension will connect to the Test environment. In this case, you must use test cards provided in the Paysafe documentation.","paysafe-checkout"))),account:React.createElement(React.Fragment,null,React.createElement("p",null,r.createInterpolateElement(t.__("Contact our <a>Integrations team</a> to get your Business Portal access and help setting up.","paysafe-checkout"),{a:React.createElement("a",{href:"https://portals.paysafe.com/helpcenter/dashboard",target:"_blank",rel:"noreferrer"})})),React.createElement("p",null,t.__("When you have access to the Business Portal, you can use it to manage all of your accounts and API keys.","paysafe-checkout")),React.createElement("p",null,t.__("You need two API keys:","paysafe-checkout")),React.createElement("ul",null,React.createElement("li",null,t.__("Public key for browser-to-Paysafe communications.","paysafe-checkout")),React.createElement("li",null,t.__("Private key for server-to-server calls.","paysafe-checkout"))),React.createElement("p",null,React.createElement("a",{href:"https://portals.paysafe.com/login",target:"_blank",rel:"noreferrer"},t.__("Visit our Merchant Portal for more details ↗","paysafe-checkout")))),shopping_experience:React.createElement("p",null,t.__("Basic settings related to the configuration of the Paysafe Checkout.","paysafe-checkout")),payment_methods:React.createElement(React.Fragment,null,React.createElement("p",null,t.__("Provide your customers with different payment methods that suit their needs.","paysafe-checkout")),React.createElement("p",null,t.__("You can select only the payment methods that you have configured with Paysafe.","paysafe-checkout")),React.createElement("p",null,t.__("If you'd like to enable additional methods, please contact customer support.","paysafe-checkout"))),shopping_features:React.createElement("p",null,t.__("Enable or disable WooCommerce subscriptions support.","paysafe-checkout")),advanced:React.createElement("p",null,t.__("Logging settings let you enable debug logs and choose whether to mask sensitive user data.","paysafe-checkout"))};function ye(){const[y,m]=r.useState({}),[i,_]=r.useState({}),[v,f]=r.useState(""),[B,_e]=r.useState(""),[de,j]=r.useState(!0),[me,fe]=r.useState(!1),[D,W]=r.useState(!1),[u,E]=r.useState(null),[R,x]=r.useState(null),[he,F]=r.useState(!1),[ke,be]=r.useState({}),[P,w]=r.useState(null),[$,H]=r.useState(null),[ve,U]=r.useState(!1),[g,S]=r.useState(null),ge=["card","neteller","applepay","googlepay"],[Y,G]=r.useState({}),[T,A]=r.useState(null),[h,V]=r.useState({sandbox:null,live:null}),[Z,I]=r.useState({}),J=u==="live"?"live":"sandbox",Q=u==="sandbox"?t.__("Sandbox","paysafe-checkout"):t.__("Live","paysafe-checkout"),[X,q]=r.useState(!1),N=r.useRef(null),Ee=u==="sandbox"?"test_public_api_key":"live_public_api_key",Re=u==="sandbox"?"test_private_api_key":"live_private_api_key",z=Object.values(y).flat().find(e=>e.key===Ee),ee=Object.values(y).flat().find(e=>e.key===Re),[te,ae]=r.useState(null);i.enabled;const we=e=>{const a=document.createElement("div");return a.innerHTML=e||"",(a.textContent||a.innerText||"").trim()},se=r.useMemo(()=>N.current?C(i)!==N.current:!1,[i]);r.useEffect(()=>{const e=a=>{!se&&!X||(a.preventDefault(),a.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[se,X]),r.useEffect(()=>{fetch(PaysafeSettingsData.apiUrl,{headers:{"X-WP-Nonce":PaysafeSettingsData.nonce}}).then(e=>e.json()).then(e=>{const a={},c={general:[],account:[],payment_methods:[],shopping_experience:[],shopping_features:[],advanced:[],card:[],neteller:[],applepay:[],googlepay:[]},o={};e.forEach(s=>{o[s.key]=s}),I(o),e.forEach(s=>{const p=(s.group||"").toLowerCase();if(!p||!c[p])return;a[s.key]=s.value??s.default??"";let d=p;(s.key.startsWith("payment_method_")||s.key.startsWith("account_id_"))&&(d="payment_methods"),c[d].push({...s,group:p})}),_(a),m(c),N.current=C(a);const n=a.test_mode==="yes"?"sandbox":"live";E(n),fe(!0),setTimeout(()=>j(!1),300)}).catch(()=>{_e(t.__("Failed to load settings.","paysafe-checkout")),j(!1)})},[]);const M=(e,a)=>{_(c=>{const o={...c,[e]:a};return e==="test_mode"&&E(a==="yes"?"sandbox":"live"),o})},ce=r.useCallback(e=>{e.preventDefault(),f(t.__("Saving...","paysafe-checkout")),q(!0);const a={...i,...h.sandbox?{payment_methods_sandbox:h.sandbox}:{},...h.live?{payment_methods_live:h.live}:{}};fetch(PaysafeSettingsData.apiUrl,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":PaysafeSettingsData.nonce},body:JSON.stringify(a)}).then(c=>{if(!c.ok)throw new Error("Save failed");return c.json()}).then(()=>{if(N.current=C(i),window.onbeforeunload=null,window.jQuery){try{window.jQuery(window).off("beforeunload.wc-settings")}catch{}try{window.jQuery(window).off("beforeunload.edit-post")}catch{}}f(t.__("Settings saved!","paysafe-checkout")),setTimeout(()=>f(""),2500)}).catch(()=>{f(t.__("Save failed.","paysafe-checkout"))}).finally(()=>{q(!1)})},[i,h]),L=e=>{const a=Object.values(y).flat().find(n=>n.key===e);if(!a)return null;const c=i[e],o={label:a.title||a.label,value:c??"",onChange:n=>M(e,n)};if(a.type==="checkbox")return React.createElement("div",{className:"paysafe-checkbox-row",tabIndex:0,role:"group","aria-label":a.description},React.createElement(l.ToggleControl,{checked:c==="yes",onChange:n=>M(e,n?"yes":"no"),"aria-label":a.title}),React.createElement("div",{className:"paysafe-checkbox-row__text"},React.createElement("div",{className:"paysafe-checkbox-row__title"},a.title),React.createElement("div",{className:"paysafe-checkbox-row__label"},a.label)));if(a.type==="select"||a.type==="paysafe_select"){const n=Object.entries(a.options||{}).map(([s,p])=>({label:p,value:s}));return n.length===1?React.createElement(l.TextControl,{className:"paysafe-text-static",label:a.title||a.label,value:n[0].label,disabled:!0}):React.createElement(l.SelectControl,{...o,options:n})}return React.createElement(l.TextControl,{...o})},ne=e=>{be(a=>({...a,[e]:!a[e]}))},le=(e,a)=>{const c=ke[a];if(!e)return null;const o=e.slice(0,80);return React.createElement("div",null,c?React.createElement(React.Fragment,null,React.createElement("div",{className:"paysafe-api-key-wrapper"},e),React.createElement(l.Button,{variant:"link",onClick:()=>ne(a),className:"paysafe-show-toggle"},t.__("Show less","paysafe-checkout"))):React.createElement("div",{className:"paysafe-api-key-wrapper"},o,React.createElement("span",{className:"paysafe-ellipsis"},"...")," ",React.createElement(l.Button,{variant:"link",onClick:()=>ne(a),className:"paysafe-show-toggle paysafe-show-more"},t.__("Show more","paysafe-checkout"))))},Se=()=>React.createElement(l.TabPanel,{key:`account-${u}`,className:"components-tab-panel paysafe-credentials-summary",activeClass:"is-active",tabs:[{name:"sandbox",title:t.__("Sandbox","paysafe-checkout")},{name:"live",title:t.__("Live","paysafe-checkout")}],onSelect:e=>E(e),initialTabName:u},e=>{const a=e.name==="sandbox",c=a?i.test_public_api_key:i.live_public_api_key,o=a?i.test_private_api_key:i.live_private_api_key;return React.createElement("div",{className:"paysafe-cred-summary"},c&&o?React.createElement(React.Fragment,null,React.createElement("div",{className:"paysafe-cred-summary__block"},React.createElement("strong",{className:"paysafe-cred-summary__label"},t.__("Public API Key","paysafe-checkout")),le(c,"public")),React.createElement("div",{className:"paysafe-cred-summary__block"},React.createElement("strong",{className:"paysafe-cred-summary__label"},t.__("Private API Key","paysafe-checkout")),le(o,"private"))):React.createElement(l.Notice,{status:"warning",isDismissible:!1},t.__("Please configure your API keys!","paysafe-checkout")))}),Ne=()=>{const e={test_public_api_key:i.test_public_api_key,test_private_api_key:i.test_private_api_key,live_public_api_key:i.live_public_api_key,live_private_api_key:i.live_private_api_key};H(e),S(e),F(!0)},oe=()=>{F(!1);const e=u==="sandbox"?"sandbox":"live",a=`_${e}`;if(ve&&g){const c={...i,...g};if(Array.isArray(T)&&T.length){const o={payment_methods:[],card:[],neteller:[],applepay:[],googlepay:[]};T.forEach(n=>{if(!n||!n.key)return;const s=String(n.key);if(!s.endsWith(a))return;const p=n.default!==void 0?n.default:n.value;if(c[s]=p??"",s.startsWith("payment_method_")||s.startsWith("account_id_"))o.payment_methods.push(n);else{const d=(n.group||"").toLowerCase();d&&Object.prototype.hasOwnProperty.call(o,d)&&o[d].push(n)}}),m(n=>{const s=(p=[],d=[])=>[...p.filter(b=>!String(b?.key||"").endsWith(a)),...d];return{...n,payment_methods:s(n.payment_methods,o.payment_methods),card:s(n.card,o.card),neteller:s(n.neteller,o.neteller),applepay:s(n.applepay,o.applepay),googlepay:s(n.googlepay,o.googlepay)}})}h?.[e]&&(c[`payment_methods_${e}`]=h[e]),_(c)}else $&&_(c=>({...c,...$}));H(null),V({sandbox:null,live:null}),A(null),U(!1),w(null),S(null),G({})},Ce=()=>{W(!0),fetch(PaysafeSettingsData.apiUrl.replace("/settings","/test-connection"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":PaysafeSettingsData.nonce},body:JSON.stringify({...i,...g||{},test_mode:u==="sandbox"?"yes":"no"})}).then(e=>e.json()).then(e=>{if(e.success){U(!0),w({status:"success",message:t.__("You successfully applied your API credentials. You can now close this dialog.","paysafe-checkout")});const a=e?.newSettings?.[`payment_methods_${J}`];if(a&&V(c=>({...c,[J]:a})),Array.isArray(e.full_fields_defaults)){A(e.full_fields_defaults);const c={};e.full_fields_defaults.forEach(o=>{c[o.key]=o}),I(c)}else if(Array.isArray(e.full_fields)){A(e.full_fields);const c={};e.full_fields.forEach(o=>{c[o.key]=o}),I(c)}}else w({status:"error",message:e.message||t.__("An unknown error occurred.","paysafe-checkout")})}).catch(()=>{w({status:"error",message:t.__("An error occurred while testing the connection.","paysafe-checkout")})}).finally(()=>W(!1))};return B?React.createElement(l.Notice,{status:"error"},B):de?React.createElement("div",{className:`paysafe-spinner-wrapper ${me?"fade-out":""}`},React.createElement(l.Spinner,null),React.createElement("p",{className:"paysafe-spinner-text"},t.__("Loading settings…","paysafe-checkout"))):React.createElement("form",{onSubmit:ce,className:"paysafe-form"},React.createElement("h1",null,t.__("Paysafe Checkout Settings","paysafe-checkout")),i?.enabled!=="yes"&&React.createElement(l.Notice,{status:"warning",isDismissible:!1,className:"paysafe-disabled-notice"},t.__("The Paysafe extension is currently disabled. Customers will not see Paysafe payment methods at checkout until you enable it.","paysafe-checkout")),Object.entries(y).filter(([e])=>!ge.includes(e)).map(([e,a])=>{const c=e==="account",o=e==="general"&&i.test_mode==="yes";let n=null;if(e==="shopping_features"){const s=Object.values(y).flat().find(p=>p.key==="subscriptions_title_missing");s&&(n=s.description)}return React.createElement("div",{key:e,className:"paysafe-section"},React.createElement("div",{className:"paysafe-section__left"},React.createElement("h2",null,ue[e]),pe[e]),React.createElement(l.Card,{className:"paysafe-section__card"},c&&Se(),c&&React.createElement(l.Button,{variant:"primary",onClick:Ne,className:"paysafe-configure-keys-btn"},t.__("Configure keys","paysafe-checkout")),e==="payment_methods"?React.createElement("div",{className:"paysafe-pm"},React.createElement(l.TabPanel,{key:`payment-${u}`,className:"paysafe-payment-tabs",activeClass:"is-active",tabs:[{name:"sandbox",title:t.__("Sandbox","paysafe-checkout")},{name:"live",title:t.__("Live","paysafe-checkout")}],onSelect:s=>E(s),initialTabName:u},()=>null),u==="sandbox"&&React.createElement("div",{className:"paysafe-warning-block"},React.createElement(l.Notice,{status:"warning",isDismissible:!1},t.__("You are configuring test payment methods.","paysafe-checkout"))),a.filter(s=>{if(!s.key.startsWith("payment_method_"))return!1;const{env:p}=K(s.key);return(p??u)===u}).map(s=>{const{currency:p,method:d,env:re}=K(s.key),b=(d||"").toLowerCase(),xe=`account_id_${p}_${d}_${re||u}`,O=a.find(k=>k.key===xe),ie=!O,Pe=i[s.key]==="yes",Te=s.custom_attributes?.icon||`assets/img/paysafe-${b}.png`,Ae=Object.values(y).flat().find(k=>k.group===b),Ie=["card","applepay","googlepay","neteller"].includes(b)&&Ae;return React.createElement("div",{key:s.key,className:"paysafe-pm-row"},React.createElement("div",{className:"paysafe-pm-row__col paysafe-pm-row__col--toggle"},ie?React.createElement(l.Tooltip,{text:u==="sandbox"&&!i.test_public_api_key||u==="live"&&!i.live_public_api_key?t.__("Please configure your API keys","paysafe-checkout"):t.__("Please enable it in your merchant portal","paysafe-checkout")},React.createElement("span",{className:"dashicons dashicons-info-outline paysafe-info-icon",tabIndex:0,role:"img"})):React.createElement(l.ToggleControl,{label:"",checked:Pe,onChange:k=>M(s.key,k?"yes":"no"),"aria-label":t.sprintf(t.__("Enable %s","paysafe-checkout"),s.title)})),React.createElement("div",{className:"paysafe-pm-row__col paysafe-pm-row__col--main"},React.createElement("div",{className:"paysafe-pm-row__icon"},React.createElement("img",{src:Te,alt:s.title,className:"paysafe-pm-row__icon-img",onError:k=>{k.currentTarget.style.display="none"}})),React.createElement("div",{className:"paysafe-pm-row__desc"},s.description)),O&&React.createElement("div",{className:"paysafe-pm-row__col paysafe-account-select"},L(O.key)),!ie&&React.createElement("div",{className:"paysafe-pm-row__col paysafe-pm-row__col--more"},Ie&&React.createElement(l.Button,{icon:"ellipsis","aria-label":t.__("More options","paysafe-checkout"),onClick:()=>x(b),className:"paysafe-more-btn"})))})):n?React.createElement(l.Notice,{status:"warning",isDismissible:!1},React.createElement("div",{dangerouslySetInnerHTML:{__html:n}})):a.filter(s=>!["test_public_api_key","test_private_api_key","live_public_api_key","live_private_api_key"].includes(s.key)&&!s.key.startsWith("payment_method_")&&!s.key.startsWith("account_id_")).map(s=>React.createElement("div",{key:s.key,className:"paysafe-field-wrap"},L(s.key),s.type!=="checkbox"&&s.description&&React.createElement("div",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:s.description}}))),o&&React.createElement(l.Notice,{status:"warning",isDismissible:!1},t.__("Paysafe payments are in sandbox mode. You need to set up a live Paysafe account before you can accept real transactions.","paysafe-checkout"))))}),React.createElement("div",{className:"paysafe-sticky-bar"},React.createElement(l.Button,{variant:"primary",onClick:ce},t.__("Save Settings","paysafe-checkout")),v&&React.createElement("span",null,v)),R&&React.createElement(l.Modal,{title:t.sprintf(t.__("More options for %s","paysafe-checkout"),R.charAt(0).toUpperCase()+R.slice(1)),onRequestClose:()=>x(null),className:"paysafe-modal paysafe-modal--method"},Object.values(y).flat().filter(e=>e.group?.toLowerCase()===R).filter(e=>!/_(sandbox|live)$/i.test(e.key)||e.key.endsWith(`_${u}`)).map(e=>{const a=e.key.startsWith("webhook_url_"),c=e.description||"",o=async()=>{const n=we(c);try{await navigator.clipboard.writeText(n)}catch{const s=document.createElement("textarea");s.value=n,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s)}ae({key:e.key,ok:!0}),setTimeout(()=>ae(null),2e3)};return React.createElement("div",{key:e.key,className:"paysafe-modal__field"},a?React.createElement(React.Fragment,null,Z.webhook_title?.description&&React.createElement("div",{className:"paysafe-webhook-title",dangerouslySetInnerHTML:{__html:Z.webhook_title.description}}),React.createElement("strong",{className:"paysafe-webhook-label"},t.__("Webhook URL","paysafe-checkout")),React.createElement("div",{className:"paysafe-webhook-url",dangerouslySetInnerHTML:{__html:c}}),React.createElement("div",{className:"paysafe-webhook-actions"},React.createElement(l.Button,{isSecondary:!0,onClick:o},t.__("Copy","paysafe-checkout")),te?.key===e.key&&te.ok&&React.createElement("span",{className:"paysafe-copied-note"},t.__("Copied to clipboard","paysafe-checkout")))):React.createElement(React.Fragment,null,L(e.key),e.description&&React.createElement("div",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:e.description}})))}),React.createElement("div",{className:"paysafe-modal__footer"},React.createElement(l.Button,{isPrimary:!0,onClick:()=>x(null)},t.__("Close","paysafe-checkout")))),he&&React.createElement(l.Modal,{title:t.sprintf(t.__("Configure %s Credentials","paysafe-checkout"),Q),onRequestClose:oe,className:"paysafe-modal paysafe-modal--credentials"},React.createElement("div",{className:"configure-keys-fields"},React.createElement(l.TextControl,{label:t.__("Public API Key","paysafe-checkout"),value:g?.[u==="sandbox"?"test_public_api_key":"live_public_api_key"]||"",onChange:e=>S(a=>({...a,[u==="sandbox"?"test_public_api_key":"live_public_api_key"]:e}))}),z?.description&&React.createElement("div",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:z.description}}),React.createElement("div",{className:"paysafe-private-key"},React.createElement(l.TextControl,{label:t.__("Private API Key","paysafe-checkout"),type:Y[u+"_private_api_key"]?"text":"password",value:g?.[u==="sandbox"?"test_private_api_key":"live_private_api_key"]||"",onChange:e=>S(a=>({...a,[u==="sandbox"?"test_private_api_key":"live_private_api_key"]:e}))}),React.createElement("button",{className:"paysafe-eye-btn",onClick:()=>G(e=>({...e,[u+"_private_api_key"]:!e[u+"_private_api_key"]})),"aria-label":t.__("Toggle visibility","paysafe-checkout")},React.createElement("span",{className:`dashicons dashicons-${Y[u+"_private_api_key"]?"hidden":"visibility"} paysafe-eye-icon`})),ee?.description&&React.createElement("div",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:ee.description}}))),u==="live"&&React.createElement("div",{className:"paysafe-live-warning"},React.createElement(l.Notice,{status:"warning",isDismissible:!1},t.__("Under no circumstances should you ever share, give out, or use your secret API key for anything other than secure server-to-server communication.","paysafe-checkout"))),P&&React.createElement(l.Notice,{status:P.status,isDismissible:!1,className:"paysafe-testconn-notice"},P.message),React.createElement("div",{className:"paysafe-modal__actions"},React.createElement(l.Button,{variant:"primary",isBusy:D,disabled:D,onClick:Ce,className:"paysafe-apply-btn"},t.sprintf(t.__("Apply %s Credentials","paysafe-checkout"),Q)),React.createElement(l.Button,{isSecondary:!0,onClick:oe},t.__("Close","paysafe-checkout")))))}r.createRoot(document.getElementById("paysafe-admin-root")).render(React.createElement(ye,null))})(wp.element,wp.components,wp.i18n);
