(function(o,l){"use strict";const re={display:"flex",flexWrap:"wrap",gap:"32px",marginTop:"24px"},ce={flex:"1 1 300px",minWidth:"250px"},pe={flex:"1 1 550px",minWidth:"300px",padding:20},ue={general:"General",account:"Account Settings",shopping_experience:"Shopping Experience",payment_methods:"Payment Methods",shopping_features:"WooCommerce Subscriptions",advanced:"Advanced Settings"},de={general:React.createElement(React.Fragment,null,React.createElement("p",null,"Enable or disable Paysafe payments."),React.createElement("p",null,"If you enable test mode, the extension will connect to the Test environment. In this case, you must use test cards provided in the Paysafe documentation.")),account:React.createElement(React.Fragment,null,React.createElement("p",null,"Contact our ",React.createElement("a",{href:"https://portals.paysafe.com/helpcenter/dashboard"},"Integrations team")," to get your Business Portal access and help setting up."),React.createElement("p",null,"When you have access to the Business Portal, you can use it to manage all of your accounts and API keys."),React.createElement("p",null,"You need two API keys:"),React.createElement("ul",null,React.createElement("li",null,"Public key for browser-to-Paysafe communications."),React.createElement("li",null,"Private key for server-to-server calls.")),React.createElement("p",null,React.createElement("a",{href:"https://portals.paysafe.com/login",target:"_blank",rel:"noreferrer"},"Visit our Merchant Portal for more details ↗"))),shopping_experience:React.createElement("p",null,"Basic settings related to the configuration of the Paysafe Checkout."),payment_methods:React.createElement(React.Fragment,null,React.createElement("p",null,"Provide your customers with different payment methods that suit their needs."),React.createElement("p",null,"You can select only the payment methods that you have configured with Paysafe."),React.createElement("p",null,"If you'd like to enable additional methods, please contact customer support.")),shopping_features:React.createElement("p",null,"Enable or disable WooCommerce subscriptions support."),advanced:React.createElement("p",null,"Logging settings let you enable debug logs and choose whether to mask sensitive user data.")},L=u=>{const m=u.match(/^payment_method_([A-Z]{3})_([A-Z0-9]+)(?:_(sandbox|live))?$/i);return m?{currency:m[1],method:m[2],env:m[3]||null}:{currency:null,method:null,env:null}};function C(u){try{return JSON.stringify(u,(c,d)=>d&&typeof d=="object"&&!Array.isArray(d)?Object.keys(d).sort().reduce((b,g)=>(b[g]=d[g],b),{}):d)}catch{return String(Math.random())}}function ye(){const[u,m]=o.useState({}),[c,d]=o.useState({}),[b,g]=o.useState(""),[O,me]=o.useState(""),[ge,W]=o.useState(!0),[_e,fe]=o.useState(!1),[K,j]=o.useState(!1),[r,E]=o.useState(null),[R,w]=o.useState(null),[he,D]=o.useState(!1),[be,ve]=o.useState({}),[T,x]=o.useState(null),[F,$]=o.useState(null),[Ee,H]=o.useState(!1),[v,k]=o.useState(null),Re=["card","neteller","applepay","googlepay"],[z,U]=o.useState({}),[P,I]=o.useState(null),[_,Y]=o.useState({sandbox:null,live:null}),[G,N]=o.useState({}),V=r==="live"?"live":"sandbox",[J,Q]=o.useState(!1),S=o.useRef(null),xe=r==="sandbox"?"test_public_api_key":"live_public_api_key",ke=r==="sandbox"?"test_private_api_key":"live_private_api_key",X=Object.values(u).flat().find(e=>e.key===xe),q=Object.values(u).flat().find(e=>e.key===ke),[Z,ee]=o.useState(null),Se=e=>{const t=document.createElement("div");return t.innerHTML=e||"",(t.textContent||t.innerText||"").trim()},te=o.useMemo(()=>S.current?C(c)!==S.current:!1,[c]);o.useEffect(()=>{const e=t=>{!te&&!J||(t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[te,J]),o.useEffect(()=>{fetch(PaysafeSettingsData.apiUrl,{headers:{"X-WP-Nonce":PaysafeSettingsData.nonce}}).then(e=>e.json()).then(e=>{const t={},n={general:[],account:[],payment_methods:[],shopping_experience:[],shopping_features:[],advanced:[],card:[],neteller:[],applepay:[],googlepay:[]},i={};e.forEach(a=>{i[a.key]=a}),N(i),e.forEach(a=>{const p=(a.group||"").toLowerCase();if(!p||!n[p])return;t[a.key]=a.value??a.default??"";let y=p;(a.key.startsWith("payment_method_")||a.key.startsWith("account_id_"))&&(y="payment_methods"),n[y].push({...a,group:p})}),d(t),m(n),S.current=C(t);const s=t.test_mode==="yes"?"sandbox":"live";E(s),fe(!0),setTimeout(()=>W(!1),300)}).catch(()=>{me("Failed to load settings."),W(!1)})},[]);const A=(e,t)=>{d(n=>{const i={...n,[e]:t};return e==="test_mode"&&E(t==="yes"?"sandbox":"live"),i})},ae=o.useCallback(e=>{e.preventDefault(),g("Saving..."),Q(!0);const t={...c,..._.sandbox?{payment_methods_sandbox:_.sandbox}:{},..._.live?{payment_methods_live:_.live}:{}};fetch(PaysafeSettingsData.apiUrl,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":PaysafeSettingsData.nonce},body:JSON.stringify(t)}).then(n=>{if(!n.ok)throw new Error("Save failed");return n.json()}).then(()=>{if(S.current=C(c),window.onbeforeunload=null,window.jQuery){try{window.jQuery(window).off("beforeunload.wc-settings")}catch{}try{window.jQuery(window).off("beforeunload.edit-post")}catch{}}g("Settings saved!"),setTimeout(()=>g(""),2500)}).catch(()=>{g("Save failed.")}).finally(()=>{Q(!1)})},[c,_]),B=e=>{const t=Object.values(u).flat().find(s=>s.key===e);if(!t)return null;const n=c[e],i={label:t.title||t.label,value:n??"",onChange:s=>A(e,s)};if(t.type==="checkbox")return React.createElement(l.Tooltip,{text:t.description},React.createElement("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px",padding:"8px",borderRadius:"4px",flexWrap:"wrap"},tabIndex:0,role:"group","aria-label":t.description},React.createElement(l.ToggleControl,{checked:n==="yes",onChange:s=>A(e,s?"yes":"no"),"aria-label":t.title}),React.createElement("div",{style:{flex:1}},React.createElement("div",{style:{fontWeight:"bold"}},t.title),React.createElement("div",{style:{color:"#666",fontSize:"13px",marginTop:4}},t.label))));if(t.type==="select"||t.type==="paysafe_select"){const s=Object.entries(t.options||{}).map(([a,p])=>({label:p,value:a}));return s.length===1?React.createElement(l.TextControl,{className:"paysafe-text-static",label:t.title||t.label,value:s[0].label,disabled:!0}):React.createElement(l.SelectControl,{...i,options:s})}return React.createElement(l.TextControl,{...i})},ne=e=>{ve(t=>({...t,[e]:!t[e]}))},se=(e,t)=>{const n=be[t];if(!e)return null;const i=e.slice(0,80);return React.createElement("div",null,n?React.createElement(React.Fragment,null,React.createElement("div",{className:"paysafe-api-key-wrapper"},e),React.createElement(l.Button,{variant:"link",onClick:()=>ne(t),className:"paysafe-show-toggle"},"Show less")):React.createElement("div",{className:"paysafe-api-key-wrapper"},i,React.createElement("span",{style:{opacity:.6}},"...")," ",React.createElement(l.Button,{variant:"link",onClick:()=>ne(t),className:"paysafe-show-toggle",style:{display:"inline",padding:0,fontSize:"13px",marginLeft:"4px"}},"Show more")))},Ce=()=>React.createElement(l.TabPanel,{key:`account-${r}`,className:"components-tab-panel",activeClass:"is-active",tabs:[{name:"sandbox",title:"Sandbox"},{name:"live",title:"Live"}],onSelect:e=>E(e),initialTabName:r},e=>{const t=e.name==="sandbox",n=t?c.test_public_api_key:c.live_public_api_key,i=t?c.test_private_api_key:c.live_private_api_key;return React.createElement("div",{style:{marginTop:"16px"}},n&&i?React.createElement(React.Fragment,null,React.createElement("div",{style:{marginBottom:"12px"}},React.createElement("strong",{style:{display:"block",marginBottom:"4px"}},"Public API Key"),se(n,"public")),React.createElement("div",null,React.createElement("strong",{style:{display:"block",marginBottom:"4px"}},"Private API Key"),se(i,"private"))):React.createElement(l.Notice,{status:"warning",isDismissible:!1},"Please configure your API Keys!"))}),we=()=>{const e={test_public_api_key:c.test_public_api_key,test_private_api_key:c.test_private_api_key,live_public_api_key:c.live_public_api_key,live_private_api_key:c.live_private_api_key};$(e),k(e),D(!0)},le=()=>{D(!1);const e=r==="sandbox"?"sandbox":"live",t=`_${e}`;if(Ee&&v){const n={...c,...v};if(Array.isArray(P)&&P.length){const i={payment_methods:[],card:[],neteller:[],applepay:[],googlepay:[]};P.forEach(s=>{if(!s||!s.key)return;const a=String(s.key);if(!a.endsWith(t))return;const p=s.default!==void 0?s.default:s.value;if(n[a]=p??"",a.startsWith("payment_method_")||a.startsWith("account_id_"))i.payment_methods.push(s);else{const y=(s.group||"").toLowerCase();y&&Object.prototype.hasOwnProperty.call(i,y)&&i[y].push(s)}}),m(s=>{const a=(p=[],y=[])=>[...p.filter(h=>!String(h?.key||"").endsWith(t)),...y];return{...s,payment_methods:a(s.payment_methods,i.payment_methods),card:a(s.card,i.card),neteller:a(s.neteller,i.neteller),applepay:a(s.applepay,i.applepay),googlepay:a(s.googlepay,i.googlepay)}})}_?.[e]&&(n[`payment_methods_${e}`]=_[e]),d(n)}else F&&d(n=>({...n,...F}));$(null),Y({sandbox:null,live:null}),I(null),H(!1),x(null),k(null),U({})},Te=()=>{j(!0),fetch(PaysafeSettingsData.apiUrl.replace("/settings","/test-connection"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":PaysafeSettingsData.nonce},body:JSON.stringify({...c,...v||{},test_mode:r==="sandbox"?"yes":"no"})}).then(e=>e.json()).then(e=>{if(e.success){H(!0),x({status:"success",message:"You successfully applied your API credentials. You can now close this dialog."});const t=e?.newSettings?.[`payment_methods_${V}`];if(t&&Y(n=>({...n,[V]:t})),Array.isArray(e.full_fields_defaults)){I(e.full_fields_defaults);const n={};e.full_fields_defaults.forEach(i=>{n[i.key]=i}),N(n)}else if(Array.isArray(e.full_fields)){I(e.full_fields);const n={};e.full_fields.forEach(i=>{n[i.key]=i}),N(n)}}else x({status:"error",message:e.message||"An unknown error occurred."})}).catch(()=>{x({status:"error",message:"An error occurred while testing the connection."})}).finally(()=>j(!1))};return O?React.createElement(l.Notice,{status:"error"},O):ge?React.createElement("div",{className:`paysafe-spinner-wrapper ${_e?"fade-out":""}`,style:{textAlign:"center",marginTop:"80px"}},React.createElement(l.Spinner,null),React.createElement("p",{style:{marginTop:"16px"}},"Loading settings…")):React.createElement("form",{onSubmit:ae,style:{maxWidth:1200,margin:"0 auto"}},React.createElement("h1",null,"Paysafe Checkout Settings"),Object.entries(u).filter(([e])=>!Re.includes(e)).map(([e,t])=>{const n=e==="account",i=e==="general"&&c.test_mode==="yes";let s=null;if(e==="shopping_features"){const a=Object.values(u).flat().find(p=>p.key==="subscriptions_title_missing");a&&(s=a.description)}return React.createElement("div",{key:e,style:re},React.createElement("div",{style:ce},React.createElement("h2",null,ue[e]),de[e]),React.createElement(l.Card,{style:pe},n&&Ce(),n&&React.createElement(l.Button,{variant:"primary",onClick:we,style:{marginTop:"16px"}},"Configure keys"),e==="payment_methods"?React.createElement("div",{style:{display:"flex",flexDirection:"column"}},React.createElement(l.TabPanel,{key:`payment-${r}`,className:"paysafe-payment-tabs",activeClass:"is-active",tabs:[{name:"sandbox",title:"Sandbox"},{name:"live",title:"Live"}],onSelect:a=>E(a),initialTabName:r},()=>null),r==="sandbox"&&React.createElement("div",{style:{marginBottom:"8px",marginTop:"8px"}},React.createElement(l.Notice,{status:"warning",isDismissible:!1},"You are configuring test payment methods.")),t.filter(a=>{if(!a.key.startsWith("payment_method_"))return!1;const{env:p}=L(a.key);return(p??r)===r}).map(a=>{const{currency:p,method:y,env:ie}=L(a.key),h=(y||"").toLowerCase(),Pe=`account_id_${p}_${y}_${ie||r}`,M=t.find(f=>f.key===Pe),oe=!M,Ie=c[a.key]==="yes",Ne=a.custom_attributes?.icon||`assets/img/paysafe-${h}.png`,Ae=Object.values(u).flat().find(f=>f.group===h),Be=["card","applepay","googlepay","neteller"].includes(h)&&Ae;return React.createElement("div",{key:a.key,style:{display:"flex",alignItems:"flex-start",padding:"12px 0",borderBottom:"1px solid #e0e0e0",gap:"16px"}},React.createElement("div",{style:{width:48,display:"flex",alignItems:"center",justifyContent:"center"}},oe?React.createElement(l.Tooltip,{text:r==="sandbox"&&!c.test_public_api_key||r==="live"&&!c.live_public_api_key?"Please configure your API keys":"Please enable it in your merchant portal"},React.createElement("span",{className:"dashicons dashicons-info-outline",style:{fontSize:30,color:"#f0b400",cursor:"help",lineHeight:.9,marginRight:20},tabIndex:0,role:"img"})):React.createElement(l.ToggleControl,{label:"",checked:Ie,onChange:f=>A(a.key,f?"yes":"no"),"aria-label":`Enable ${a.title}`})),React.createElement("div",{style:{flex:1}},React.createElement("div",{style:{width:40}},React.createElement("img",{src:Ne,alt:a.title,style:{height:18},onError:f=>{f.currentTarget.style.display="none"}})),React.createElement("div",{style:{fontSize:13,color:"#666"}},a.description)),M&&React.createElement("div",{className:"paysafe-account-select"},B(M.key)),!oe&&React.createElement("div",{style:{width:40,textAlign:"center"}},Be&&React.createElement(l.Button,{icon:"ellipsis",label:"More options",onClick:()=>w(h),style:{cursor:"pointer"}})))})):s?React.createElement(l.Notice,{status:"warning",isDismissible:!1},React.createElement("div",{dangerouslySetInnerHTML:{__html:s}})):t.filter(a=>!["test_public_api_key","test_private_api_key","live_public_api_key","live_private_api_key"].includes(a.key)&&!a.key.startsWith("payment_method_")&&!a.key.startsWith("account_id_")).map(a=>React.createElement("div",{key:a.key,style:{marginBottom:12}},B(a.key),a.type!=="checkbox"&&a.description&&React.createElement("div",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:a.description}}))),i&&React.createElement(l.Notice,{status:"warning",isDismissible:!1},"Paysafe payments are in sandbox mode. You need to set up a live Paysafe account before you can accept real transactions.")))}),React.createElement("div",{style:{position:"fixed",bottom:"20px",right:"20px",zIndex:100,background:"#fff",padding:"12px 20px",borderRadius:"8px",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:"16px"}},React.createElement(l.Button,{variant:"primary",onClick:ae},"Save Settings"),b&&React.createElement("span",null,b)),R&&React.createElement(l.Modal,{title:`More options for ${R.charAt(0).toUpperCase()+R.slice(1)}`,onRequestClose:()=>w(null),style:{width:800}},Object.values(u).flat().filter(e=>e.group?.toLowerCase()===R).filter(e=>!/_(sandbox|live)$/i.test(e.key)||e.key.endsWith(`_${r}`)).map(e=>{const t=e.key.startsWith("webhook_url_"),n=e.description||"",i=async()=>{const s=Se(n);try{await navigator.clipboard.writeText(s)}catch{const a=document.createElement("textarea");a.value=s,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}ee({key:e.key,ok:!0}),setTimeout(()=>ee(null),2e3)};return React.createElement("div",{key:e.key,style:{marginBottom:"16px"}},t?React.createElement(React.Fragment,null,G.webhook_title?.description&&React.createElement("div",{style:{marginBottom:"16px"},dangerouslySetInnerHTML:{__html:G.webhook_title.description}}),React.createElement("strong",{style:{display:"block",marginBottom:4}},"Webhook URL"),React.createElement("div",{className:"paysafe-webhook-url",dangerouslySetInnerHTML:{__html:n}}),React.createElement("div",{style:{display:"flex",alignItems:"center",gap:8}},React.createElement(l.Button,{isSecondary:!0,onClick:i},"Copy"),Z?.key===e.key&&Z.ok&&React.createElement("span",{style:{fontSize:12,color:"#1a7f37"}},"Copied to clipboard"))):React.createElement(React.Fragment,null,B(e.key),e.description&&React.createElement("div",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:e.description}})))}),React.createElement("div",{style:{marginTop:"20px"}},React.createElement(l.Button,{isPrimary:!0,onClick:()=>w(null)},"Close"))),he&&React.createElement(l.Modal,{title:`Configure ${r==="sandbox"?"Sandbox":"Live"} Credentials`,onRequestClose:le,style:{width:800}},React.createElement("div",{className:"configure-keys-fields"},React.createElement(l.TextControl,{label:"Public API Key",value:v?.[r==="sandbox"?"test_public_api_key":"live_public_api_key"]||"",onChange:e=>k(t=>({...t,[r==="sandbox"?"test_public_api_key":"live_public_api_key"]:e}))}),X?.description&&React.createElement("div",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:X.description}}),React.createElement("div",{style:{position:"relative",marginTop:"16px"}},React.createElement(l.TextControl,{label:"Private API Key",type:z[r+"_private_api_key"]?"text":"password",value:v?.[r==="sandbox"?"test_private_api_key":"live_private_api_key"]||"",onChange:e=>k(t=>({...t,[r==="sandbox"?"test_private_api_key":"live_private_api_key"]:e})),style:{paddingRight:"40px"}}),React.createElement("button",{onClick:()=>U(e=>({...e,[r+"_private_api_key"]:!e[r+"_private_api_key"]})),style:{position:"absolute",top:"50%",transform:"translateY(-50%)",right:"10px",background:"transparent",border:"none",cursor:"pointer",padding:0,lineHeight:1},"aria-label":"Toggle visibility"},React.createElement("span",{className:`dashicons dashicons-${z[r+"_private_api_key"]?"hidden":"visibility"}`,style:{fontSize:"18px",color:"#555"}})),q?.description&&React.createElement("div",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:q.description}}))),r==="live"&&React.createElement("div",{style:{marginTop:"16px"}},React.createElement(l.Notice,{status:"warning",isDismissible:!1},"Under no circumstances should you ever share, give out, or use your secret API key for anything other than secure server-to-server communication.")),T&&React.createElement(l.Notice,{status:T.status,isDismissible:!1,style:{marginTop:"16px"}},T.message),React.createElement("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"12px",marginTop:"20px"}},React.createElement(l.Button,{variant:"primary",isBusy:K,disabled:K,onClick:Te,style:{backgroundColor:"#3B5BF9",borderColor:"#3B5BF9",color:"#fff"}},"Apply ",r==="sandbox"?"Sandbox":"Live"," Credentials"),React.createElement(l.Button,{isSecondary:!0,onClick:le},"Close"))))}o.createRoot(document.getElementById("paysafe-admin-root")).render(React.createElement(ye,null))})(wp.element,wp.components);
